

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>permittivitycalc.sparam_data &mdash; permittivitycalc  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> permittivitycalc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../airlinedata.html">Scattering Parameter Data and the AirlineData Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../permittivity_plot.html">Plotting Fucntions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../piter.html">MCMC-based Permittivity/Permeability Determination</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/basic/permittivitycalc_tutorial.html">Basic Usage</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">permittivitycalc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>permittivitycalc.sparam_data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for permittivitycalc.sparam_data</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># Array math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">uncertainties</span> 
<span class="c1">#Citation: Uncertainties: a Python package for calculations with uncertainties,</span>
<span class="c1">#    Eric O. LEBIGOT, http://pythonhosted.org/uncertainties/</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="k">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>
<span class="c1"># Plotting</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">permittivity_plot</span> <span class="k">as</span> <span class="n">pplot</span>
<span class="c1"># Make relative path</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># Helper functions</span>
<span class="kn">from</span> <span class="nn">.helper_functions</span> <span class="k">import</span> <span class="n">get_METAS_data</span><span class="p">,</span> <span class="n">_get_file</span><span class="p">,</span> <span class="n">perm_compare</span>

<span class="c1"># GLOBAL VARIABLES</span>
<span class="n">E_0</span> <span class="o">=</span> <span class="mf">8.854187817620</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">12</span> <span class="c1">#Permittivity of vacuum (F/m) </span>
<span class="n">U_0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">7</span> <span class="c1">#Permeability of vacuum (V*s/A*m) </span>
<span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E_0</span><span class="o">*</span><span class="n">U_0</span><span class="p">)</span> <span class="c1">#Speed of light (m/s)</span>
<span class="n">LAM_C</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span> <span class="c1">#Cut-off wavelength = infinity</span>
<span class="n">PACKAGEPATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">DATAPATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PACKAGEPATH</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="AirlineData"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData">[docs]</a><span class="k">class</span> <span class="nc">AirlineData</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use S-parameter data from a METAS VNA Tools II output text file to </span>
<span class="sd">    calculate the complex relative permittivity of a sample in a coaxial </span>
<span class="sd">    transmission line</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    L : float </span>
<span class="sd">        Length of airline in cm.</span>
<span class="sd">        </span>
<span class="sd">    airline : {&#39;VAL&#39;, &#39;PAL&#39;, &#39;GAL&#39;, &#39;7&#39;, &#39;custom&#39;}</span>
<span class="sd">        Name of airline used for measurement.</span>
<span class="sd">        </span>
<span class="sd">    dataArray : array</span>
<span class="sd">        Array containing raw measurement data.</span>
<span class="sd">        </span>
<span class="sd">    file : str </span>
<span class="sd">        Input file path.</span>
<span class="sd">        </span>
<span class="sd">    corr : bool, optional</span>
<span class="sd">        Default = False. If True, also correct S-parameter data and produce </span>
<span class="sd">        corrected arrays. </span>
<span class="sd">            </span>
<span class="sd">    nrw : bool, optional </span>
<span class="sd">        Default = False. If True, use Nicolson, Rross, Weir (NRW) algorithm to </span>
<span class="sd">        calculate permittivity and magnetic permeability.</span>
<span class="sd">            </span>
<span class="sd">    shorted : bool, optional</span>
<span class="sd">        Default = False. If True, automatically load Shorted S11 data. File </span>
<span class="sd">        name must have the following format and be in the same folder as </span>
<span class="sd">        original file: file_path/file_name_shorted.txt</span>
<span class="sd">        </span>
<span class="sd">        Example:</span>
<span class="sd">            - file_path/air_atm.txt</span>
<span class="sd">            - file_path/air_atm_shorted.txt</span>
<span class="sd">            </span>
<span class="sd">    normalize_density : bool or float or int, optional </span>
<span class="sd">        Default = False. If True, use either Lichtenecker or </span>
<span class="sd">        Landau-Lifshitz-Looyenga equation to normalize the complex </span>
<span class="sd">        permittivity to a constant density of 1.60 g/cm^3. If float or int </span>
<span class="sd">        is given, normalize to the density provided in g/cm^3. Requires </span>
<span class="sd">        that bulk_density be given.</span>
<span class="sd">        </span>
<span class="sd">    norm_eqn : {&#39;LI&#39;,&#39;LLL&#39;}, optional </span>
<span class="sd">        Default = &#39;LI&#39;. For use with normalize_density. Equation to be used for </span>
<span class="sd">        normalization. Options are &#39;LI&#39; for the Lichtenecker </span>
<span class="sd">        equation and &#39;LLL&#39; for the Landau-Lifshitz-Looyenga equation. </span>
<span class="sd">        LI used alpha = 1.92 (Olhoeft, 1985) and LLL uses </span>
<span class="sd">        alpha = 0.307 (Hickson et al., 2017, Lunar samples).</span>
<span class="sd">            </span>
<span class="sd">    name : str, optional </span>
<span class="sd">        Name of measurement to be used in plots.</span>
<span class="sd">            </span>
<span class="sd">    bulk_density : float, optional</span>
<span class="sd">        Bulk density of material.</span>
<span class="sd">        </span>
<span class="sd">    solid_dielec : float, optional </span>
<span class="sd">        The solid dielectric constant of the material.</span>
<span class="sd">        </span>
<span class="sd">    solid_losstan : float, optional</span>
<span class="sd">        The solid loss tangent of the material.</span>
<span class="sd">        </span>
<span class="sd">    particle_diameter : float, optional</span>
<span class="sd">        The average particle diameter in the airline in cm.</span>
<span class="sd">        </span>
<span class="sd">    particle_density : float, optional</span>
<span class="sd">        The average (solid) particle density of the material in g/cm^3.</span>
<span class="sd">        </span>
<span class="sd">    temperature : str or float, optional </span>
<span class="sd">        Temperature of measurement.</span>
<span class="sd">        </span>
<span class="sd">    date : str, optional</span>
<span class="sd">        Date measurement was made.</span>
<span class="sd">            </span>
<span class="sd">    freq_cutoff : float, optional</span>
<span class="sd">        Default: 1e8. Starting frequency for forward and reverse difference </span>
<span class="sd">        calculations.</span>
<span class="sd">    </span>
<span class="sd">    freq : array </span>
<span class="sd">        Frequency points.</span>
<span class="sd">    </span>
<span class="sd">    s11, s21, s12, s22 : array </span>
<span class="sd">        Mag and Phase S-Parameters.</span>
<span class="sd">    </span>
<span class="sd">    avg_dielec, forward_dielec, reverse_dielec : array </span>
<span class="sd">        Real part of the permittivity. Can be avg_dielec, forward_dielec, or </span>
<span class="sd">        reverse_dielec for average, forward (S11,S21), or reverse (S22,S12) </span>
<span class="sd">        permittivity.</span>
<span class="sd">    </span>
<span class="sd">    avg_lossfac, forward_lossfac, reverse_lossfac : array </span>
<span class="sd">        Imaginary part of the permittivity. Same as above.</span>
<span class="sd">    </span>
<span class="sd">    avg_losstan, forward_losstan, reverse_losstan : array </span>
<span class="sd">        Loss tangent. Same as above.</span>
<span class="sd">        </span>
<span class="sd">    avg_mu_real, forward_mu_real, reverse_mu_real : array</span>
<span class="sd">        Real part of the magnetic permeability. Same as above.</span>
<span class="sd">        </span>
<span class="sd">    avg_mu_imag, forward_mu_imag, reverse_mu_imag : array</span>
<span class="sd">        Imaginary part of the magnetic permeability. Same as above.</span>
<span class="sd">    </span>
<span class="sd">    corr_ : array </span>
<span class="sd">        De-embeded version of S-parameters or electromagnetic data. Only average </span>
<span class="sd">        S-parameters are used for EM calculations with corrected </span>
<span class="sd">        S-parameters. Examples: corr_s11, corr_avg_losstan, corr_avg_mu_real. </span>
<span class="sd">        Only created if corr = True.</span>
<span class="sd">            </span>
<span class="sd">    norm_ : array</span>
<span class="sd">        Bulk density normalized permittivity data. Uses averaged permittivity </span>
<span class="sd">        data. Only created if normalize_density = True.</span>
<span class="sd">        </span>
<span class="sd">    res_freq : array </span>
<span class="sd">        Resonant frequencies in the sample.</span>
<span class="sd">        </span>
<span class="sd">    airline_dimensions : dict </span>
<span class="sd">        Dimensions of the airline in cm. D1 is the diameter of the inner </span>
<span class="sd">        conductor and D4 is the diameter of the outer conductor. D2 and D3 </span>
<span class="sd">        bound the sample-airline boundary regions if particle_diameter is </span>
<span class="sd">        provided. airline_dimensions is generated automatically for </span>
<span class="sd">        airlines VAL, PAL, and GAL. Empty otherwise.</span>
<span class="sd">        </span>
<span class="sd">    bcorr : complex array </span>
<span class="sd">        Avg complex permittivity corrected for boundary effects. Computed </span>
<span class="sd">        automatically if solid_dielec, particle_diameter, particle_density, </span>
<span class="sd">        and bulk_density are present. solid_losstan is optional.</span>
<span class="sd">        </span>
<span class="sd">    real_part_diff_array, imag_part_diff_array : array</span>
<span class="sd">        Absolute difference of forward and reverse results for the real and </span>
<span class="sd">        imaginary parts of the permittivity.</span>
<span class="sd">            </span>
<span class="sd">    max_real_diff, max_imag_diff, min_real_diff, min_imag_diff : float</span>
<span class="sd">        Maximum and minimum differences of the forward and reverse results for </span>
<span class="sd">        the real and imaginary parts of the permittivity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">airline</span><span class="p">,</span><span class="n">dataArray</span><span class="p">,</span><span class="n">file</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                 <span class="n">freq_cutoff</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span><span class="n">nrw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">shorted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">corr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                 <span class="n">normalize_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">norm_eqn</span><span class="o">=</span><span class="s1">&#39;LI&#39;</span><span class="p">,</span><span class="n">bulk_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                 <span class="n">solid_dielec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">solid_losstan</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">particle_diameter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
                 <span class="n">particle_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Required Attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">airline_name</span> <span class="o">=</span> <span class="n">airline</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
        
        <span class="c1"># Optional attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span> <span class="o">=</span> <span class="n">freq_cutoff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span> <span class="o">=</span> <span class="n">nrw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shorted</span> <span class="o">=</span> <span class="n">shorted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corr</span> <span class="o">=</span> <span class="n">corr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span> <span class="o">=</span> <span class="n">normalize_density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_eqn</span> <span class="o">=</span> <span class="n">norm_eqn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span> <span class="o">=</span> <span class="n">bulk_density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solid_dielec</span> <span class="o">=</span> <span class="n">solid_dielec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solid_losstan</span> <span class="o">=</span> <span class="n">solid_losstan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particle_diameter</span> <span class="o">=</span> <span class="n">particle_diameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particle_density</span> <span class="o">=</span> <span class="n">particle_density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature</span>
        
        <span class="c1"># Get the airline dimnetions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dims</span><span class="p">()</span>
        
        <span class="c1"># Unpack data into arrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s22</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_unpack</span><span class="p">(</span><span class="n">dataArray</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shorted</span><span class="p">:</span>
            <span class="c1">#Get path of shorted file</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">file_name_full</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name_full</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">file_name_shorted</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s1">&#39;_shorted.txt&#39;</span>
            <span class="n">path_shorted</span> <span class="o">=</span> <span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">file_name_shorted</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">path_shorted</span><span class="p">)</span>
            <span class="c1"># Check if file exists</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path_shorted</span><span class="p">):</span>
                <span class="n">dataArray2</span> <span class="o">=</span> <span class="n">get_METAS_data</span><span class="p">(</span><span class="n">airline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_name</span><span class="p">,</span><span class="n">file_path</span><span class="o">=</span><span class="n">path_shorted</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">freq_short</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s11_short</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack</span><span class="p">(</span><span class="n">dataArray2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Shorted file does not exists. Sould be in the form: orig-filename_shorted.txt&#39;</span><span class="p">)</span>
        
        <span class="c1"># Calculate permittivity</span>
        <span class="k">if</span> <span class="n">nrw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forward_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_lossfac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_losstan</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">forward_mu_real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_mu_imag</span> \
                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_permittivity_calc</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_lossfac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_losstan</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">reverse_mu_real</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_mu_imag</span> \
                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_permittivity_calc</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_dielec</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_dielec</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_lossfac</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_lossfac</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avg_mu_real</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_mu_real</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_mu_real</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avg_mu_imag</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_mu_imag</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_mu_imag</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avg_losstan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forward_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_lossfac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_losstan</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_permittivity_calc</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reverse_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_lossfac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_losstan</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_permittivity_calc</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_dielec</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_dielec</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_lossfac</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_lossfac</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avg_losstan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span>

        <span class="c1"># Try to calculate corrected (de-embedded) permittivity</span>
        <span class="c1"># Fail if NaNs in data</span>
        <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Lcorr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">)</span> <span class="c1"># Remove total washer length </span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Lcorr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">-</span> <span class="mf">0.34</span> <span class="c1"># Remove total washer length </span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">corr_s11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s21</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s12</span><span class="p">,</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_s22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_de_embed</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">nrw</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_lossfac</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_losstan</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_mu_real</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_mu_imag</span> \
                            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_permittivity_calc</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_lossfac</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_losstan</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_mu_real</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_mu_imag</span> \
                            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_permittivity_calc</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_dielec</span> <span class="o">+</span> \
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_dielec</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_lossfac</span> <span class="o">+</span> \
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_lossfac</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_losstan</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_mu_real</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_mu_real</span> <span class="o">+</span> \
                                           <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_mu_real</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_mu_imag</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_mu_imag</span> <span class="o">+</span> \
                                           <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_mu_imag</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_lossfac</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_losstan</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">_permittivity_calc</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_lossfac</span><span class="p">,</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_losstan</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">_permittivity_calc</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_dielec</span> <span class="o">+</span> \
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_dielec</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_lossfac</span> <span class="o">+</span> \
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_lossfac</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_losstan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;S-parameter correction failed. Using uncorrected data. Check if NaNs in data.&#39;</span><span class="p">)</span>
            
        <span class="c1"># Calculate percentage difference between forward and reverse permittivity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">real_part_diff_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag_part_diff_array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tand_part_diff_array</span><span class="p">,</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">max_real_diff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_imag_diff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_tand_diff</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">med_real_diff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">med_imag_diff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">med_tand_diff</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_absdiff</span><span class="p">()</span>
        <span class="c1"># Print maximum and median difference as percentages</span>
        <span class="n">diff_results</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;The maximum precentage difference between forward (S11/S21) and reverse (S22/S12) calculated permittivity is: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;ε′: </span><span class="si">{:.2%}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_real_diff</span><span class="p">)</span> <span class="o">+</span> \
            <span class="s1">&#39;ε′′: </span><span class="si">{:.2%}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_imag_diff</span><span class="p">)</span> <span class="o">+</span> \
            <span class="s1">&#39;tanδ: </span><span class="si">{:.2%}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_tand_diff</span><span class="p">)</span> <span class="o">+</span> \
            <span class="s1">&#39;The median precentage difference between forward (S11/S21) and reverse (S22/S12) calculated permittivity is: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> \
            <span class="s1">&#39;ε′: </span><span class="si">{:.2%}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">med_real_diff</span><span class="p">)</span> <span class="o">+</span> \
            <span class="s1">&#39;ε′′: </span><span class="si">{:.2%}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">med_imag_diff</span><span class="p">)</span> <span class="o">+</span> \
            <span class="s1">&#39;tanδ: </span><span class="si">{:.2%}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">med_tand_diff</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">diff_results</span><span class="p">)</span>
        
        <span class="c1"># Combine Type A and Type B Uncertainty (if it exists)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">uncertainties</span><span class="o">.</span><span class="n">UFloat</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_losstan</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_calcTotalUncertainty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="p">,</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">avg_losstan</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="p">,</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_losstan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calcTotalUncertainty</span><span class="p">(</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="p">,</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_losstan</span><span class="p">)</span>
                    
        <span class="c1"># Calculare resonant frequencies in sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res_freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resonant_freq</span><span class="p">()</span>
        
        <span class="c1"># Calculate an average real permittivity and loss tan value from </span>
        <span class="c1">#   midpoint frequency values between resonant frequencies.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_avg_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_avg_losstan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_avg_dielec_std</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">freq_avg_losstan_std</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_freq_avg</span><span class="p">()</span>
            
        <span class="c1"># If normalize_density is not False and bulk_density exists, normalize</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">:</span>   <span class="c1">#use corrected data is present</span>
                <span class="n">complex_dielec</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="p">);</span>
                <span class="n">complex_dielec</span> <span class="o">+=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">complex_dielec</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="p">);</span>
                <span class="n">complex_dielec</span> <span class="o">+=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span><span class="p">)</span>
            <span class="c1"># If normalize_density is True, normalize to to 1.60 g/cm^3</span>
            <span class="c1">#   If normalize_density is a value, normalize to that value</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">norm_val</span> <span class="o">=</span> <span class="mf">1.60</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
                <span class="n">norm_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_eqn</span> <span class="o">==</span> <span class="s1">&#39;LI&#39;</span><span class="p">:</span>
                <span class="c1"># Lichtenecker equation</span>
                <span class="c1">#   alpha from Carrier et al., 1991</span>
                <span class="n">norm_complex_dielec</span> <span class="o">=</span> <span class="n">complex_dielec</span><span class="o">*</span><span class="p">((</span><span class="mf">1.92</span><span class="p">)</span><span class="o">**</span>\
                    <span class="p">(</span><span class="n">norm_val</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_eqn</span> <span class="o">==</span> <span class="s1">&#39;LLL&#39;</span><span class="p">:</span>
                <span class="c1"># Landau-Lifshitz-Looyenga equation</span>
                <span class="c1">#   alpha from Hickson et al., 2018</span>
                <span class="n">norm_complex_dielec</span> <span class="o">=</span> <span class="n">complex_dielec</span><span class="o">*</span><span class="p">((</span><span class="n">norm_val</span><span class="o">*</span><span class="mf">0.307</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> \
                                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span><span class="o">*</span><span class="mf">0.307</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
            <span class="c1"># Get uncertainty</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">:</span>
                <span class="n">unc_real</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span><span class="p">)</span>
                <span class="n">unc_imag</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unc_real</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span><span class="p">)</span>
                <span class="n">unc_imag</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">norm_complex_dielec</span><span class="p">),</span><span class="n">unc_real</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">norm_complex_dielec</span><span class="p">),</span><span class="n">unc_imag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_losstan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_lossfac</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">norm_dielec</span>
        <span class="k">elif</span> <span class="n">normalize_density</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Need bulk desnity to normalize to constant density&#39;</span><span class="p">)</span>
                    
        <span class="c1"># If appropriate data provided, correct for boundary effects</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">solid_dielec</span> <span class="ow">and</span> <span class="n">particle_diameter</span> <span class="ow">and</span> <span class="n">particle_density</span> <span class="ow">and</span> \
            <span class="n">bulk_density</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcorr_dielec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcorr_losstan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boundary_correct</span><span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rep</span> <span class="o">=</span> <span class="s1">&#39;pc.AirlineData(*pc.get_METAS_data(airline=</span><span class="si">%r</span><span class="s1">,file_path=</span><span class="si">%r</span><span class="s1">),&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s1">&#39;bulk_density=</span><span class="si">%r</span><span class="s1">,temperature=</span><span class="si">%r</span><span class="s1">,name=</span><span class="si">%r</span><span class="s1">,date=</span><span class="si">%r</span><span class="s1">,corr=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>\
                 <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,solid_dielec=</span><span class="si">%r</span><span class="s1">,solid_losstan=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> \
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solid_dielec</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">solid_losstan</span><span class="p">)</span> <span class="o">+</span> \
                 <span class="s1">&#39;,particle_diameter=</span><span class="si">%r</span><span class="s1">,particle_density=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> \
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particle_diameter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_density</span><span class="p">)</span> <span class="o">+</span> \
                 <span class="s1">&#39;,nrw=</span><span class="si">%r</span><span class="s1">,normalize_density=</span><span class="si">%r</span><span class="s1">,norm_eqn=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> \
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_eqn</span><span class="p">)</span> <span class="o">+</span> \
                 <span class="s1">&#39;,shorted=</span><span class="si">%r</span><span class="s1">,freq_cutoff=</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> \
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shorted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rep</span>
        
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">srep</span> <span class="o">=</span> <span class="s1">&#39;measured in &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">airline_name</span> <span class="o">+</span> <span class="s1">&#39; (L = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">srep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">srep</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">:</span>
            <span class="n">srep</span> <span class="o">+=</span> <span class="s1">&#39; on &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">:</span>
            <span class="n">srep</span> <span class="o">+=</span> <span class="s1">&#39; at &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; degrees&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span><span class="p">:</span>
            <span class="n">srep</span> <span class="o">+=</span> <span class="s1">&#39; with a bulk density of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; g/cm^3&#39;</span>
        <span class="n">srep</span> <span class="o">+=</span> <span class="s1">&#39; from file: </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">:</span>
            <span class="n">srep</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;Corrected (de-embeded) data is available.&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">norm_val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mf">1.60</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
                <span class="n">norm_val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span><span class="p">)</span>
            <span class="n">srep</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;Normalized data at a bulk density of &#39;</span> <span class="o">+</span> <span class="n">norm_val</span> \
            <span class="o">+</span> <span class="s1">&#39; g/cm^3&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_eqn</span> <span class="o">==</span> <span class="s1">&#39;LI&#39;</span><span class="p">:</span>
                <span class="n">srep</span> <span class="o">+=</span> <span class="s1">&#39; using the Lichtenecker equation&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_eqn</span> <span class="o">==</span> <span class="s1">&#39;LLL&#39;</span><span class="p">:</span>
                <span class="n">srep</span> <span class="o">+=</span> <span class="s1">&#39; using the Landau-Lifshitz-Looyenga equation&#39;</span>
            <span class="n">srep</span> <span class="o">+=</span> <span class="s1">&#39; is available.&#39;</span>
        <span class="k">return</span> <span class="n">srep</span>
    
    <span class="k">def</span> <span class="nf">_unpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dataArray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See if uncertainty in data and unpack to S-parameter arrays&quot;&quot;&quot;</span>
        <span class="n">shorted_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">dataArray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">17</span><span class="p">:</span> <span class="c1"># Has unc so use unumpy</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">dataArray</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s11</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">([</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]],</span>\
                                     <span class="p">[</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]])</span>
            <span class="n">s21</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">([</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">5</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]],</span>\
                                     <span class="p">[</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">6</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">8</span><span class="p">]])</span>
            <span class="n">s12</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">([</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">9</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">11</span><span class="p">]],</span>\
                                      <span class="p">[</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">10</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">12</span><span class="p">]])</span>
            <span class="n">s22</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">([</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">13</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">15</span><span class="p">]],</span>\
                                     <span class="p">[</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">14</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">16</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">dataArray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span> <span class="c1"># No unc</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">dataArray</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]])</span>
            <span class="n">s21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]])</span>
            <span class="n">s12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">5</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]])</span>
            <span class="n">s22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">7</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">8</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shorted</span> <span class="ow">and</span> <span class="n">dataArray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">shorted_flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">dataArray</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">s11</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">([</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]],</span>\
                                     <span class="p">[</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">dataArray</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Input file has the wrong number of columns&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">shorted_flag</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">s11</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">freq</span><span class="p">,</span> <span class="n">s11</span><span class="p">,</span> <span class="n">s21</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s22</span>
    
    <span class="k">def</span> <span class="nf">_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the dimensions of the airline used in cm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Store inner and outer diameters in a dictionary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">airline_name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;VAL&#39;</span><span class="p">,</span><span class="s1">&#39;PAL&#39;</span><span class="p">):</span>
            <span class="n">dims</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">6.204</span>
            <span class="n">dims</span><span class="p">[</span><span class="s1">&#39;D4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">14.288</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">airline_name</span> <span class="o">==</span> <span class="s1">&#39;GAL&#39;</span><span class="p">:</span>
            <span class="n">dims</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">6.19</span>
            <span class="n">dims</span><span class="p">[</span><span class="s1">&#39;D4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">14.32</span>
        <span class="c1"># If particle diameter is known, calculate D2 and D3 for boundary </span>
        <span class="c1">#   effect correction   </span>
        <span class="k">if</span> <span class="n">dims</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_diameter</span><span class="p">:</span>
            <span class="n">dims</span><span class="p">[</span><span class="s1">&#39;D2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_diameter</span>
            <span class="n">dims</span><span class="p">[</span><span class="s1">&#39;D3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="s1">&#39;D4&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_diameter</span>
        <span class="k">return</span> <span class="n">dims</span>
    
<div class="viewcode-block" id="AirlineData._absdiff"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData._absdiff">[docs]</a>    <span class="k">def</span> <span class="nf">_absdiff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the absolute max and median differences in calculated forward </span>
<span class="sd">        (S11,S21) and reverse (S22,S12) permittivity. Use corrected </span>
<span class="sd">        S-parameters if present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">:</span>
            <span class="n">real_part_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_dielec</span><span class="p">)</span> \
                            <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_dielec</span><span class="p">))</span>
            <span class="n">imag_part_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_lossfac</span><span class="p">)</span> \
                            <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_lossfac</span><span class="p">))</span>
            <span class="n">tand_part_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_losstan</span><span class="p">)</span> \
                            <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_losstan</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">real_part_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_dielec</span><span class="p">)</span> \
                            <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_dielec</span><span class="p">))</span>
            <span class="n">imag_part_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_lossfac</span><span class="p">)</span> \
                            <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_lossfac</span><span class="p">))</span>
            <span class="n">tand_part_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_losstan</span><span class="p">)</span> \
                            <span class="o">-</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_losstan</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">:</span>
            <span class="n">real_avg</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span><span class="p">)</span>
            <span class="n">imag_avg</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="p">)</span>
            <span class="n">tand_avg</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_losstan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">real_avg</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span><span class="p">)</span>
            <span class="n">imag_avg</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="p">)</span>
            <span class="n">tand_avg</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_losstan</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">:</span>
            <span class="n">real_part_diff_calc</span> <span class="o">=</span> <span class="n">real_part_diff</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">]</span>\
                <span class="o">/</span><span class="n">real_avg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">]</span>
            <span class="n">imag_part_diff_calc</span> <span class="o">=</span> <span class="n">imag_part_diff</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">]</span>\
                <span class="o">/</span><span class="n">imag_avg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">]</span>
            <span class="n">tand_part_diff_calc</span> <span class="o">=</span> <span class="n">tand_part_diff</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">]</span>\
                <span class="o">/</span><span class="n">tand_avg</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">real_part_diff_calc</span> <span class="o">=</span> <span class="n">real_part_diff</span><span class="o">/</span><span class="n">real_avg</span>
            <span class="n">imag_part_diff_calc</span> <span class="o">=</span> <span class="n">imag_part_diff</span><span class="o">/</span><span class="n">imag_avg</span>
            <span class="n">tand_part_diff_calc</span> <span class="o">=</span> <span class="n">tand_part_diff</span><span class="o">/</span><span class="n">tand_avg</span>
        
        <span class="n">max_real_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">real_part_diff_calc</span><span class="p">)</span>
        <span class="n">max_imag_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">imag_part_diff_calc</span><span class="p">)</span>
        <span class="n">max_tand_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tand_part_diff_calc</span><span class="p">)</span>
        <span class="n">avg_real_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">real_part_diff_calc</span><span class="p">)</span>
        <span class="n">avg_imag_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">imag_part_diff_calc</span><span class="p">)</span>
        <span class="n">avg_tand_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tand_part_diff_calc</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">real_part_diff</span><span class="p">,</span> <span class="n">imag_part_diff</span><span class="p">,</span> <span class="n">tand_part_diff</span><span class="p">,</span> <span class="n">max_real_diff</span><span class="p">,</span> \
            <span class="n">max_imag_diff</span><span class="p">,</span> <span class="n">max_tand_diff</span><span class="p">,</span> <span class="n">avg_real_diff</span><span class="p">,</span> <span class="n">avg_imag_diff</span><span class="p">,</span> \
            <span class="n">avg_tand_diff</span></div>
            
<div class="viewcode-block" id="AirlineData._resonant_freq"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData._resonant_freq">[docs]</a>    <span class="k">def</span> <span class="nf">_resonant_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and return array of resonant frequencies from complex </span>
<span class="sd">        permittivity and/or permeability measurement.</span>
<span class="sd">    </span>
<span class="sd">        Follows David Stillman PhD Thesis</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span> <span class="c1"># Max number of resonances (overkill)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">:</span>
            <span class="n">measured_dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span><span class="p">)</span>
            <span class="n">measured_lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lcorr</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                <span class="k">global</span> <span class="n">u_r</span>
                <span class="n">u_r</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_mu_real</span><span class="p">)</span>
                <span class="n">u_i</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_mu_imag</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">measured_dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span><span class="p">)</span>
            <span class="n">measured_lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                <span class="n">u_r</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_mu_real</span><span class="p">)</span>
                <span class="n">u_i</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_mu_imag</span><span class="p">)</span>
        <span class="n">e_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">measured_dielec</span><span class="p">[</span><span class="mi">1</span><span class="p">::])</span> <span class="c1"># Exclude first data point</span>
        <span class="n">e_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">measured_lossfac</span><span class="p">[</span><span class="mi">1</span><span class="p">::])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
            <span class="n">u_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">u_r</span><span class="p">[</span><span class="mi">1</span><span class="p">::])</span>
            <span class="n">u_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">u_i</span><span class="p">[</span><span class="mi">1</span><span class="p">::])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u_r</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">u_i</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">res_freq</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">C</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="p">((((</span><span class="n">u_r</span><span class="o">*</span><span class="n">e_r</span> <span class="o">-</span> <span class="n">e_i</span><span class="o">*</span><span class="n">u_i</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
                    <span class="p">(</span><span class="n">u_i</span><span class="o">*</span><span class="n">e_r</span> <span class="o">+</span> <span class="n">e_i</span><span class="o">*</span><span class="n">u_r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">e_r</span><span class="o">*</span><span class="n">u_r</span> <span class="o">-</span> <span class="n">e_i</span><span class="o">*</span><span class="n">u_i</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="c1"># Restrict res_freq to max freq</span>
        <span class="n">res_freq</span> <span class="o">=</span> <span class="n">res_freq</span><span class="p">[</span><span class="n">res_freq</span><span class="o">&lt;=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">res_freq</span></div>
    
<div class="viewcode-block" id="AirlineData._freq_avg"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData._freq_avg">[docs]</a>    <span class="k">def</span> <span class="nf">_freq_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate an average dielectric constant and loss tangent across all </span>
<span class="sd">        measured frequencies from midpoint frequency values between resonant </span>
<span class="sd">        frequencies as described in Hickson et al., 2018</span>
<span class="sd">        </span>
<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        freq_avg_dielec : uncertainties.core.AffineScalarFunc </span>
<span class="sd">            Average dielectric constant calculated from midpoint frequency </span>
<span class="sd">            values between resonant frequencies. Skips first two values due to </span>
<span class="sd">            large uncertainty. </span>
<span class="sd">        </span>
<span class="sd">        freq_avg_dielec_std : float </span>
<span class="sd">            Standard deviation of freq_avg_dielec from above.</span>
<span class="sd">        </span>
<span class="sd">        freq_avg_losstan : uncertainties.core.AffineScalarFunc </span>
<span class="sd">            Average loss tangent calculated from midpoint frequency values </span>
<span class="sd">            between resonant frequencies. Skips first two values due to large </span>
<span class="sd">            uncertainty. </span>
<span class="sd">        </span>
<span class="sd">        freq_avg_losstan_std : float </span>
<span class="sd">            Standard deviation of freq_avg_losstan from above.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res_freq</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">:</span>
            <span class="n">dielec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span>
            <span class="n">lossfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dielec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span>
            <span class="n">lossfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span>
        <span class="n">mid_pts</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f_r</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="c1">#, dtype=int)</span>
        <span class="n">f_0_mids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f_r</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="c1">#, dtype=int)</span>
        <span class="n">dielec_mids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">loss_tan_mids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">f_r</span> <span class="o">=</span> <span class="n">f_r</span><span class="p">[</span><span class="n">f_r</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">f_r</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f_r</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Find the midpoint frequencies between resonances</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_r</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">f_r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">mid_pts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span>
                <span class="c1"># Find the closest corresponding frequency index in f_0</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">-</span> <span class="n">mid_pts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="c1"># index of closest value</span>
                <span class="n">f_0_mids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">dielec_mids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dielec</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="n">loss_tan_mids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lossfac</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">/</span><span class="n">dielec</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>        
        <span class="c1"># Calculate averages past first two values </span>
        <span class="n">freq_avg_dielec</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dielec_mids</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="n">std_dielec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">dielec_mids</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span>
        <span class="n">freq_avg_losstan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">loss_tan_mids</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
        <span class="n">std_losstan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">loss_tan_mids</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span>
        
        <span class="k">return</span> <span class="n">freq_avg_dielec</span><span class="p">,</span> <span class="n">freq_avg_losstan</span><span class="p">,</span> <span class="n">std_dielec</span><span class="p">,</span> <span class="n">std_losstan</span></div>
    
<div class="viewcode-block" id="AirlineData._permittivity_calc"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData._permittivity_calc">[docs]</a>    <span class="k">def</span> <span class="nf">_permittivity_calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s_param</span><span class="p">,</span><span class="n">corr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the complex permittivity and loss tangent from S-parameters </span>
<span class="sd">        and their uncertainties (if present).</span>
<span class="sd">    </span>
<span class="sd">        Uses the New Non-iterative method described in Boughriet, A.H., Legrand, </span>
<span class="sd">        C. &amp; Chapoton, A., 1997. Noniterative stable transmission/reflection </span>
<span class="sd">        method for low-loss material complex permittivity determination. </span>
<span class="sd">        IEEE Transactions on Microwave Theory and Techniques, 45(1), pp.52–57.</span>
<span class="sd">        </span>
<span class="sd">        Assumes the magnetic permeability of the sample = 1 (i.e non-magnetic).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s_param : str </span>
<span class="sd">            Calculates complex permittivity using either </span>
<span class="sd">            the forward (&#39;f&#39;) (S11,S21), or the reverse (&#39;r&#39;) (S22 S12) </span>
<span class="sd">            S-Parameters.</span>
<span class="sd">            </span>
<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        f_0 : array </span>
<span class="sd">            Array of measured frequency values.</span>
<span class="sd">        </span>
<span class="sd">        dielec : array </span>
<span class="sd">            Real part of the complex relative permittivity.</span>
<span class="sd">        </span>
<span class="sd">        lossfac : array </span>
<span class="sd">            Imaginary part of the complex permittivity.</span>
<span class="sd">        </span>
<span class="sd">        losstan : array </span>
<span class="sd">            Loss tangent. Defined as the ratio of the imaginary </span>
<span class="sd">            and the real part of the complex permittivity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Check if using corrected S-params</span>
        <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>
            <span class="n">s11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s11</span>
            <span class="n">s21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s21</span>
            <span class="n">s12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s12</span>
            <span class="n">s22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s22</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lcorr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s11</span>
            <span class="n">s21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21</span>
            <span class="n">s12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s12</span>
            <span class="n">s22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s22</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
        
        <span class="c1"># Strip arrays of their uncertainties</span>
        <span class="c1">#   This measure is temporary as the uncertainties module does not </span>
        <span class="c1">#   support complex numbers at the time of writing.</span>
        <span class="c1">#   Later, uncertainties may be propagated through and compared with</span>
        <span class="c1">#   those calculated in Boughriet et al.</span>
        <span class="k">if</span> <span class="n">s_param</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
            <span class="n">s_r</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span>
            <span class="n">s_t</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">s21</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s_r</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">s22</span><span class="p">)</span>
            <span class="n">s_t</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">s12</span><span class="p">)</span>
            
        <span class="c1"># Initialize arrays</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
        <span class="n">gam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        
        <span class="c1">### NOTE: change function from np to unp to propagate uncertainties ###</span>
        
        <span class="c1"># Calculate complex permittivity</span>
        <span class="n">lam_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> <span class="c1">#Free-space wavelength (cm)</span>
            
        <span class="c1"># Convert phase to radians</span>
        <span class="n">s_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">s_r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">s_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">s_t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># Convert to rectangular notation (cast to complex)</span>
        <span class="n">s_reflect</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">s_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">s_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span> \
        <span class="n">s_reflect</span> <span class="o">+=</span> <span class="n">s_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">s_r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">s_trans</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">s_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">s_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> \
        <span class="n">s_trans</span> <span class="o">+=</span> <span class="n">s_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">s_t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># Calculate X (root of reflection coefficient)  </span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">((</span><span class="n">s_reflect</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">s_trans</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">s_reflect</span><span class="p">)</span>
        
        <span class="c1"># Calculate Gamma (reflection coefficient) </span>
        <span class="n">gam1</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">gam2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Determine correct root with condition |GAMMA| &lt; 1 </span>
        <span class="n">sign</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">gam1</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">sign</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">gam1</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># Check if sign is true or false and assign coresponding gamma value to gam</span>
        <span class="n">gam</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span> <span class="o">=</span> <span class="n">gam1</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span>      <span class="c1">#if sign is true set gam to gam1</span>
        <span class="n">gam</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span> <span class="o">=</span> <span class="n">gam2</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span>      <span class="c1">#if false set to gam2</span>
        
        <span class="c1"># Calculate T (transmission coefficient)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">s_trans</span> <span class="o">+</span> <span class="n">s_reflect</span> <span class="o">-</span> <span class="n">gam</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">s_reflect</span> <span class="o">+</span> <span class="n">s_trans</span><span class="p">)</span> <span class="o">*</span> <span class="n">gam</span><span class="p">))</span>
        <span class="c1"># Unwrap phase ambiguities in phase angle of T</span>
        <span class="c1"># From Chen, L. F. et al. (2004). Microwave Electronics: Measurement and Materials Characterization</span>
        <span class="n">t_phaser</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="c1">#get phase angle from complex</span>
        <span class="n">t_phase_unwrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">t_phaser</span><span class="p">)</span>
        <span class="c1"># Ignore NaN values</span>
        <span class="n">t_phase_unwrap</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">t_phase_unwrap</span><span class="p">)]</span> <span class="o">=</span> \
                       <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">t_phase_unwrap</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">t_phase_unwrap</span><span class="p">)])</span>
                       
        <span class="c1"># Calculate ln(1/T) with correct phases</span>
        <span class="n">ln_1_T</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">t_phase_unwrap</span><span class="p">;</span> <span class="n">ln_1_T</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="c1"># Also create new unwrapped T vector</span>
        <span class="n">new_t</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">t_phase_unwrap</span><span class="p">;</span> <span class="n">new_t</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        
        <span class="c1"># Calculate 1/A</span>
        <span class="n">a_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">ln_1_T</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">L</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
         
        <span class="c1"># Calculate A</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">a_1</span>
          
        <span class="c1"># Find wavelength in empty cell</span>
        <span class="n">lam_og</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">lam_0</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">LAM_C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Calculated effective electromagnetic parameters</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
            <span class="c1"># Calculate mu_r (relative permeability)</span>
            <span class="n">mu_r</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">gam</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">gam</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">lam_0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">LAM_C</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
            <span class="n">mu_eff</span> <span class="o">=</span> <span class="n">mu_r</span>
            <span class="c1"># Calculate e_r (relative permittivity)</span>
            <span class="n">ep_r</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_r</span><span class="o">*</span><span class="p">(((</span><span class="mi">1</span><span class="o">-</span><span class="n">gam</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">gam</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">lam_0</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">LAM_C</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> \
                    <span class="o">+</span> <span class="p">((</span><span class="n">lam_0</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">LAM_C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">mu_r</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mu_eff</span> <span class="o">=</span> <span class="mi">1</span>      <span class="c1">#Assume mu_eff = mu_r = 1</span>
            <span class="n">ep_eff</span> <span class="o">=</span> <span class="p">(</span><span class="n">lam_og</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="c1"># Calculate e_r (relative permittivity)</span>
            <span class="n">ep_r</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lam_0</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">LAM_C</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">ep_eff</span> <span class="o">+</span> \
            <span class="p">(</span><span class="n">lam_0</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">LAM_C</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">mu_eff</span>
        
        <span class="n">dielec</span> <span class="o">=</span> <span class="n">ep_r</span><span class="o">.</span><span class="n">real</span>
        <span class="n">lossfac</span> <span class="o">=</span> <span class="n">ep_r</span><span class="o">.</span><span class="n">imag</span>
        <span class="n">losstan</span> <span class="o">=</span> <span class="n">lossfac</span><span class="o">/</span><span class="n">dielec</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
            <span class="n">complex_mu</span> <span class="o">=</span> <span class="n">mu_eff</span>
            <span class="n">mu_real</span> <span class="o">=</span> <span class="n">complex_mu</span><span class="o">.</span><span class="n">real</span>
            <span class="n">mu_imag</span> <span class="o">=</span> <span class="n">complex_mu</span><span class="o">.</span><span class="n">imag</span>
        
        <span class="c1"># Calculate uncertainties</span>
        <span class="c1"># Check for uncertainties and make sure not using NRW</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">uncertainties</span><span class="o">.</span><span class="n">UFloat</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span> 
            <span class="n">delta_dielec</span><span class="p">,</span> <span class="n">delta_lossfac</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_uncertainties</span><span class="p">(</span><span class="n">s_param</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">sign</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">s_reflect</span><span class="p">,</span>\
                                         <span class="n">s_trans</span><span class="p">,</span><span class="n">gam</span><span class="p">,</span><span class="n">lam_og</span><span class="p">,</span><span class="n">new_t</span><span class="p">,</span><span class="n">mu_eff</span><span class="p">,</span>\
                                         <span class="n">ep_eff</span><span class="p">,</span><span class="n">lam_0</span><span class="p">,</span><span class="n">dielec</span><span class="p">,</span><span class="n">lossfac</span><span class="p">,</span><span class="n">losstan</span><span class="p">,</span>\
                                         <span class="n">corr</span><span class="p">)</span>
            <span class="n">dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">dielec</span><span class="p">,</span><span class="n">delta_dielec</span><span class="p">)</span>
            <span class="n">lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">lossfac</span><span class="p">,</span><span class="n">delta_lossfac</span><span class="p">)</span>
            <span class="n">losstan</span> <span class="o">=</span> <span class="n">losstan</span> <span class="o">=</span> <span class="n">lossfac</span><span class="o">/</span><span class="n">dielec</span>  
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">uncertainties</span><span class="o">.</span><span class="n">UFloat</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span> 
            <span class="n">delta_dielec</span><span class="p">,</span> <span class="n">delta_lossfac</span><span class="p">,</span> <span class="n">delta_mureal</span><span class="p">,</span> <span class="n">delta_muimag</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_calc_uncertainties_NRW</span><span class="p">(</span><span class="n">s_param</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">sign</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">s_reflect</span><span class="p">,</span>\
                                         <span class="n">s_trans</span><span class="p">,</span><span class="n">gam</span><span class="p">,</span><span class="n">lam_og</span><span class="p">,</span><span class="n">new_t</span><span class="p">,</span><span class="n">complex_mu</span><span class="p">,</span>\
                                         <span class="n">ep_r</span><span class="p">,</span><span class="n">lam_0</span><span class="p">,</span><span class="n">dielec</span><span class="p">,</span><span class="n">lossfac</span><span class="p">,</span><span class="n">losstan</span><span class="p">,</span>\
                                         <span class="n">corr</span><span class="p">)</span>
            <span class="n">dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">dielec</span><span class="p">,</span><span class="n">delta_dielec</span><span class="p">)</span>
            <span class="n">lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">lossfac</span><span class="p">,</span><span class="n">delta_lossfac</span><span class="p">)</span>
            <span class="n">losstan</span> <span class="o">=</span> <span class="n">losstan</span> <span class="o">=</span> <span class="n">lossfac</span><span class="o">/</span><span class="n">dielec</span>
            <span class="n">mu_real</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">mu_real</span><span class="p">,</span><span class="n">delta_mureal</span><span class="p">)</span>
            <span class="n">mu_imag</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">mu_imag</span><span class="p">,</span><span class="n">delta_muimag</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dielec</span><span class="p">,</span><span class="n">lossfac</span><span class="p">,</span><span class="n">losstan</span><span class="p">,</span><span class="n">mu_real</span><span class="p">,</span><span class="n">mu_imag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dielec</span><span class="p">,</span><span class="n">lossfac</span><span class="p">,</span><span class="n">losstan</span></div>
        
<div class="viewcode-block" id="AirlineData._calc_uncertainties"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData._calc_uncertainties">[docs]</a>    <span class="k">def</span> <span class="nf">_calc_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s_param</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">sign</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">s_reflect</span><span class="p">,</span><span class="n">s_trans</span><span class="p">,</span><span class="n">gam</span><span class="p">,</span>\
                            <span class="n">lam_og</span><span class="p">,</span><span class="n">new_t</span><span class="p">,</span><span class="n">mu_eff</span><span class="p">,</span><span class="n">ep_eff</span><span class="p">,</span><span class="n">lam_0</span><span class="p">,</span><span class="n">dielec</span><span class="p">,</span>\
                            <span class="n">lossfac</span><span class="p">,</span><span class="n">losstan</span><span class="p">,</span><span class="n">corr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates permittivity uncertainties from Boughriet et al.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        delta_dielec : array </span>
<span class="sd">            Uncertainty in real part.</span>
<span class="sd">        </span>
<span class="sd">        delta_lossfac : array </span>
<span class="sd">            Uncertainty in imaginary part.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if using corrected S-params</span>
        <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>
            <span class="n">s11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s11</span>
            <span class="n">s21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s21</span>
            <span class="n">s12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s12</span>
            <span class="n">s22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s22</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lcorr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s11</span>
            <span class="n">s21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21</span>
            <span class="n">s12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s12</span>
            <span class="n">s22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s22</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
        
        <span class="c1"># Strip uarrays of their nominal values</span>
        <span class="k">if</span> <span class="n">s_param</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
            <span class="n">err_s_r</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span>
            <span class="n">err_s_t</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">s21</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err_s_r</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">s22</span><span class="p">)</span>
            <span class="n">err_s_t</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">s12</span><span class="p">)</span>
        
        <span class="c1"># Initialize arrays</span>
        <span class="n">delta_length</span> <span class="o">=</span> <span class="mf">0.002</span> <span class="c1">#in cm</span>
        <span class="n">dgam_dS_reflect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="n">dgam_dS_trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        
        <span class="c1"># Calculate partial derivatives</span>
        <span class="c1"># Determine +/- ambiguity by condition |GAMMA| &lt; 1 from before            </span>
        <span class="n">dgam_dS_reflect</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span><span class="o">*</span>\
                        <span class="p">(((</span><span class="mi">2</span><span class="o">*</span><span class="n">s_reflect</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">s_trans</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>\
                         <span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">s_reflect</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dgam_dS_trans</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span><span class="o">*</span>\
                        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">s_trans</span><span class="p">[</span><span class="n">sign</span><span class="p">]</span><span class="o">/</span><span class="n">s_reflect</span><span class="p">[</span><span class="n">sign</span><span class="p">]))</span>
        
        <span class="n">dgam_dS_reflect</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> \
                        <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>\
                        <span class="o">*</span><span class="p">(((</span><span class="mi">2</span><span class="o">*</span><span class="n">s_reflect</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>\
                           <span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">s_trans</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>\
                        <span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">s_reflect</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dgam_dS_trans</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span>\
                        <span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>\
                        <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">(</span><span class="n">s_trans</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]</span><span class="o">/</span><span class="n">s_reflect</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">sign</span><span class="p">)]))</span>
     
        <span class="n">dT_dS_reflect</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">gam</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dgam_dS_reflect</span><span class="o">*</span><span class="p">(((</span><span class="n">s_reflect</span> <span class="o">+</span> <span class="n">s_trans</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> \
                        <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">s_reflect</span> <span class="o">+</span> <span class="n">s_trans</span><span class="p">)</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dT_dS_trans</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">gam</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dgam_dS_trans</span><span class="o">*</span><span class="p">(((</span><span class="n">s_reflect</span> <span class="o">+</span> <span class="n">s_trans</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> \
                        <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">s_reflect</span> <span class="o">+</span> <span class="n">s_trans</span><span class="p">)</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">#deff_dgam = 0  # 0 in Boughriet, 1997</span>
        <span class="n">deff_dT</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">lam_og</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">L</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">new_t</span><span class="p">))</span>\
                        <span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">lam_og</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="n">new_t</span><span class="p">))</span>
        
        <span class="n">deff_dS_reflect_mag</span> <span class="o">=</span> <span class="p">(</span><span class="n">deff_dT</span><span class="o">*</span><span class="n">dT_dS_reflect</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">s_reflect</span><span class="p">))</span>
        <span class="n">deff_dS_trans_mag</span> <span class="o">=</span> <span class="p">(</span><span class="n">deff_dT</span><span class="o">*</span><span class="n">dT_dS_trans</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">s_trans</span><span class="p">))</span>
        
        <span class="n">deff_dS_reflect_phase</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">s_reflect</span><span class="p">)</span><span class="o">*</span><span class="n">deff_dS_reflect_mag</span>
        <span class="n">deff_dS_trans_phase</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">s_trans</span><span class="p">)</span><span class="o">*</span><span class="n">deff_dS_trans_mag</span>
        
        <span class="c1"># From Baker-Jarvis tech note 1992 can get dT_dd (or just calculate it)</span>
        <span class="n">dT_dd</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu_eff</span><span class="o">*</span><span class="n">ep_eff</span><span class="p">)</span><span class="o">*</span>\
                 <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu_eff</span><span class="o">*</span><span class="n">ep_eff</span><span class="p">))</span><span class="o">/</span><span class="n">lam_og</span><span class="p">))</span><span class="o">/</span><span class="n">lam_og</span>
        
        <span class="n">deff_dL</span> <span class="o">=</span> <span class="n">deff_dT</span><span class="o">*</span><span class="n">dT_dd</span>
        
        <span class="c1"># Combine partial derivatives for overal measurement uncertainty</span>
        <span class="c1"># Final Type B Uncertainty</span>
        <span class="n">delta_dielec</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">lam_0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">LAM_C</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>\
            <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deff_dS_reflect_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deff_dS_reflect_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deff_dS_trans_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deff_dS_trans_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deff_dL</span><span class="p">))</span><span class="o">*</span><span class="n">delta_length</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="n">delta_lossfac</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">lam_0</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">LAM_C</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>\
            <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">deff_dS_reflect_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">deff_dS_reflect_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">deff_dS_trans_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">deff_dS_trans_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">deff_dL</span><span class="p">))</span><span class="o">*</span><span class="n">delta_length</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">delta_dielec</span><span class="p">,</span> <span class="n">delta_lossfac</span></div>
    
<div class="viewcode-block" id="AirlineData._calc_uncertainties_NRW"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData._calc_uncertainties_NRW">[docs]</a>    <span class="k">def</span> <span class="nf">_calc_uncertainties_NRW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s_param</span><span class="p">,</span><span class="n">nrows</span><span class="p">,</span><span class="n">sign</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">s_reflect</span><span class="p">,</span>\
                                         <span class="n">s_trans</span><span class="p">,</span><span class="n">gam</span><span class="p">,</span><span class="n">lam_og</span><span class="p">,</span><span class="n">new_t</span><span class="p">,</span><span class="n">complex_mu</span><span class="p">,</span>\
                                         <span class="n">ep_r</span><span class="p">,</span><span class="n">lam_0</span><span class="p">,</span><span class="n">dielec</span><span class="p">,</span><span class="n">lossfac</span><span class="p">,</span><span class="n">losstan</span><span class="p">,</span>\
                                         <span class="n">corr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates nrw uncertainties from Baker-Jarvis et al. (1993). </span>
<span class="sd">        Transmission/reflection and short-circuit line methods for measuring </span>
<span class="sd">        permittivity and permeability. NIST Technical Note 1355-R. Boulder, </span>
<span class="sd">        CO: National Institute of Standards and Technology. </span>
<span class="sd">        http://doi.org/10.6028/NIST.TN.1355r</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        delta_dielec : array </span>
<span class="sd">            Uncertainty in real part.</span>
<span class="sd">        </span>
<span class="sd">        delta_lossfac : array </span>
<span class="sd">            Uncertainty in imaginary part.</span>
<span class="sd">            </span>
<span class="sd">        delta_mu : complex array</span>
<span class="sd">            Uncertainty in complex permeability.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if using corrected S-params</span>
        <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>
            <span class="n">s11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s11</span>
            <span class="n">s21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s21</span>
            <span class="n">s12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s12</span>
            <span class="n">s22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_s22</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lcorr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s11</span>
            <span class="n">s21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21</span>
            <span class="n">s12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s12</span>
            <span class="n">s22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s22</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
        
        <span class="c1"># Strip uarrays of their nominal values</span>
        <span class="k">if</span> <span class="n">s_param</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
            <span class="n">err_s_r</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span>
            <span class="n">err_s_t</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">s21</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err_s_r</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">s22</span><span class="p">)</span>
            <span class="n">err_s_t</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">s12</span><span class="p">)</span>
        
        <span class="n">delta_length</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="c1">#in cm</span>
        <span class="n">e_0</span> <span class="o">=</span> <span class="n">E_0</span><span class="o">*</span><span class="mi">100</span>
        <span class="n">mu_0</span> <span class="o">=</span> <span class="n">U_0</span><span class="o">*</span><span class="mi">100</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">complex_mu</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">ep_r</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">new_t</span>
        <span class="n">omega</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
        <span class="n">small_gam</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">lam_0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eps</span><span class="o">*</span><span class="n">mu</span> <span class="o">-</span> \
                    <span class="p">(</span><span class="n">lam_0</span><span class="o">/</span><span class="n">LAM_C</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">small_gam_0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">lam_0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="p">(</span><span class="n">lam_0</span><span class="o">/</span><span class="n">LAM_C</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># (2.95)</span>
        <span class="n">dT_dmu</span> <span class="o">=</span> <span class="p">((</span><span class="n">L</span><span class="o">*</span><span class="n">eps</span><span class="o">*</span><span class="p">(</span><span class="n">omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">e_0</span><span class="o">*</span><span class="n">mu_0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">small_gam</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">small_gam</span><span class="o">*</span><span class="n">L</span><span class="p">)</span>
        <span class="c1"># (2.94)</span>
        <span class="n">dT_deps</span> <span class="o">=</span> <span class="p">((</span><span class="n">L</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="n">omega</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">e_0</span><span class="o">*</span><span class="n">mu_0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">small_gam</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">small_gam</span><span class="o">*</span><span class="n">L</span><span class="p">)</span>
        <span class="c1"># (2.93)</span>
        <span class="n">dT_dL</span> <span class="o">=</span> <span class="o">-</span><span class="n">small_gam</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">small_gam</span><span class="o">*</span><span class="n">L</span><span class="p">)</span>
        <span class="c1"># (2.91)</span>
        <span class="n">dgam_deps</span> <span class="o">=</span> <span class="p">(</span><span class="n">small_gam_0</span><span class="o">*</span><span class="p">(</span><span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">e_0</span><span class="o">*</span><span class="n">mu_0</span><span class="o">*</span><span class="p">(</span><span class="n">omega</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>\
                        <span class="o">/</span><span class="p">(</span><span class="n">small_gam</span><span class="o">*</span><span class="p">(</span><span class="n">small_gam</span> <span class="o">+</span> <span class="n">small_gam_0</span><span class="o">*</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># (2.92)</span>
        <span class="n">dgam_dmu</span> <span class="o">=</span> <span class="n">eps</span><span class="o">*</span><span class="n">dgam_deps</span><span class="o">/</span><span class="n">mu</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">small_gam_0</span><span class="o">*</span><span class="n">small_gam</span><span class="o">/</span><span class="p">(</span><span class="n">small_gam</span> <span class="o">+</span> \
                        <span class="n">small_gam_0</span><span class="o">*</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># (2.90)</span>
        <span class="n">dS_trans_dgam</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">gam</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># (2.89)</span>
        <span class="n">dS_trans_dT</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># (2.88)</span>
        <span class="n">dS_reflect_dT</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">gam</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="p">((</span><span class="n">gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># (2.87)</span>
        <span class="n">dS_reflect_dgam</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">t</span><span class="o">**</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> \
                          <span class="p">(</span><span class="n">gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># (2.74)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">dS_reflect_dT</span><span class="o">*</span><span class="n">dT_deps</span> <span class="o">+</span> <span class="n">dS_reflect_dgam</span><span class="o">*</span><span class="n">dgam_deps</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">dS_reflect_dT</span><span class="o">*</span><span class="n">dT_dmu</span> <span class="o">+</span> <span class="n">dS_reflect_dgam</span><span class="o">*</span><span class="n">dgam_dmu</span>
        <span class="c1"># (2.75)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">dS_trans_dT</span><span class="o">*</span><span class="n">dT_deps</span> <span class="o">+</span> <span class="n">dS_trans_dgam</span><span class="o">*</span><span class="n">dgam_deps</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">dS_trans_dT</span><span class="o">*</span><span class="n">dT_dmu</span> <span class="o">+</span> <span class="n">dS_trans_dgam</span><span class="o">*</span><span class="n">dgam_dmu</span>
        <span class="c1"># (2.77)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="o">-</span><span class="n">dS_reflect_dT</span><span class="o">*</span><span class="n">dT_dL</span>
        <span class="c1"># (2.78)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="o">-</span><span class="n">dS_trans_dT</span><span class="o">*</span><span class="n">dT_dL</span>
        <span class="c1"># (2.79)</span>
        <span class="n">deps_dS_reflect_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">s_reflect</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="o">/</span><span class="n">d</span><span class="p">)</span>
        <span class="c1"># (2.80)</span>
        <span class="n">dmu_dS_reflect_mag</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">deps_dS_reflect_mag</span><span class="o">/</span><span class="n">d</span>
        <span class="c1"># trans</span>
        <span class="n">deps_dS_trans_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">s_trans</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">d</span><span class="o">*</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>
        <span class="n">dmu_dS_trans_mag</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">deps_dS_trans_mag</span><span class="o">/</span><span class="n">b</span>
        <span class="c1"># (2.81)</span>
        <span class="n">deps_dL</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">f</span> <span class="o">-</span> <span class="n">d</span><span class="o">*</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">d</span><span class="p">)</span>
        <span class="c1"># (2.82)</span>
        <span class="n">dmu_dL</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">deps_dL</span><span class="p">)</span><span class="o">/</span><span class="n">b</span>
        <span class="c1"># (2.83)</span>
        <span class="n">deps_dS_reflect_phase</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">s_reflect</span><span class="p">)</span><span class="o">*</span><span class="n">deps_dS_reflect_mag</span>
        <span class="c1"># (2.84)</span>
        <span class="n">dmu_dS_reflect_phase</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">s_reflect</span><span class="p">)</span><span class="o">*</span><span class="n">dmu_dS_reflect_mag</span>
        <span class="c1"># (2.85)</span>
        <span class="n">deps_dS_trans_phase</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">s_trans</span><span class="p">)</span><span class="o">*</span><span class="n">deps_dS_trans_mag</span>
        <span class="c1"># (2.86)</span>
        <span class="n">dmu_dS_trans_phase</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">s_trans</span><span class="p">)</span><span class="o">*</span><span class="n">dmu_dS_reflect_mag</span>
        <span class="c1"># (2.67)</span>
        <span class="n">delta_dielec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deps_dS_reflect_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deps_dS_reflect_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deps_dS_trans_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deps_dS_trans_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">deps_dL</span><span class="p">))</span><span class="o">*</span><span class="n">delta_length</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="c1"># (2.68)</span>
        <span class="n">delta_lossfac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">deps_dS_reflect_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">deps_dS_reflect_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">deps_dS_trans_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">deps_dS_trans_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">deps_dL</span><span class="p">))</span><span class="o">*</span><span class="n">delta_length</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="c1"># mu</span>
        <span class="n">delta_mureal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dmu_dS_reflect_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dmu_dS_reflect_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dmu_dS_trans_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dmu_dS_trans_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dmu_dL</span><span class="p">))</span><span class="o">*</span><span class="n">delta_length</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">delta_muimag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">dmu_dS_reflect_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">dmu_dS_reflect_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">dmu_dS_trans_mag</span><span class="p">))</span><span class="o">*</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">dmu_dS_trans_phase</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">err_s_t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
            <span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">dmu_dL</span><span class="p">))</span><span class="o">*</span><span class="n">delta_length</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">delta_dielec</span><span class="p">,</span> <span class="n">delta_lossfac</span><span class="p">,</span> <span class="n">delta_mureal</span><span class="p">,</span> <span class="n">delta_muimag</span></div>
    
    <span class="k">def</span> <span class="nf">_calcTotalUncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dielec</span><span class="p">,</span><span class="n">lossfac</span><span class="p">,</span><span class="n">losstan</span><span class="p">):</span>
        <span class="c1"># Type A Uncertainty. Note 2 regions for lossfac and losstan</span>
        <span class="n">dielec_TypeA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">real_part_diff_array</span> <span class="o">&gt;</span> <span class="mf">0.008</span><span class="p">,</span>\
                                <span class="bp">self</span><span class="o">.</span><span class="n">real_part_diff_array</span><span class="p">,</span><span class="mf">0.008</span><span class="p">)</span>
        <span class="n">lossfac_TypeA_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">imag_part_diff_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mf">0.009</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">imag_part_diff_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)],</span> <span class="mf">0.009</span><span class="p">)</span>
        <span class="n">lossfac_TypeA_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">imag_part_diff_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&gt;=</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mf">0.002</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">imag_part_diff_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&gt;=</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)],</span> <span class="mf">0.002</span><span class="p">)</span>
        <span class="n">lossfac_TypeA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">lossfac_TypeA_high</span><span class="p">,</span><span class="n">lossfac_TypeA_low</span><span class="p">))</span>
        <span class="n">losstan_TypeA_high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">tand_part_diff_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mf">0.009</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">tand_part_diff_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)],</span> <span class="mf">0.009</span><span class="p">)</span>
        <span class="n">losstan_TypeA_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">tand_part_diff_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&gt;=</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)]</span> <span class="o">&gt;</span> <span class="mf">0.002</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">tand_part_diff_array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&gt;=</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)],</span> <span class="mf">0.002</span><span class="p">)</span>
        <span class="n">losstan_TypeA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">losstan_TypeA_high</span><span class="p">,</span><span class="n">losstan_TypeA_low</span><span class="p">))</span>
        
        <span class="c1"># Type B Uncertainty</span>
        <span class="n">delta_dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">dielec</span><span class="p">)</span>
        <span class="n">delta_lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">lossfac</span><span class="p">)</span>
        <span class="n">delta_losstan</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">losstan</span><span class="p">)</span>
        
        <span class="c1"># Combined Uncertainty</span>
        <span class="n">unc_dielec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta_dielec</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dielec_TypeA</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">unc_lossfac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta_lossfac</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lossfac_TypeA</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">unc_losstan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta_losstan</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">losstan_TypeA</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Final uArrays</span>
        <span class="n">dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">dielec</span><span class="p">),</span><span class="n">unc_dielec</span><span class="p">)</span>
        <span class="n">lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">lossfac</span><span class="p">),</span><span class="n">unc_lossfac</span><span class="p">)</span>
        <span class="n">losstan</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">losstan</span><span class="p">),</span><span class="n">unc_losstan</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">dielec</span><span class="p">,</span> <span class="n">lossfac</span><span class="p">,</span> <span class="n">losstan</span>
    
<div class="viewcode-block" id="AirlineData._de_embed"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData._de_embed">[docs]</a>    <span class="k">def</span> <span class="nf">_de_embed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform S-parameter de-embedding to remove influence of washers on </span>
<span class="sd">        measurement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get washer length</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">L_washer1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">L_washer2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">)):</span>
            <span class="n">L_washer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">L_washer</span> <span class="o">=</span> <span class="mf">0.17</span>
        <span class="c1"># Create synthetic teflon washer s-parameters</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mf">0.0007</span><span class="p">;</span>
        <span class="n">epsilon</span> <span class="o">+=</span> <span class="mf">2.1</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">0</span>
        <span class="n">lam_0</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span> <span class="c1"># (m)</span>
        <span class="n">small_gam</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">lam_0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">epsilon</span><span class="o">*</span><span class="n">mu</span> <span class="o">-</span> \
                        <span class="p">(</span><span class="n">lam_0</span><span class="o">/</span><span class="n">LAM_C</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">small_gam_0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">lam_0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="p">(</span><span class="n">lam_0</span><span class="o">/</span><span class="n">LAM_C</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">big_gam</span> <span class="o">=</span> <span class="p">(</span><span class="n">small_gam_0</span><span class="o">*</span><span class="n">mu</span> <span class="o">-</span> <span class="n">small_gam</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">small_gam_0</span><span class="o">*</span><span class="n">mu</span> <span class="o">+</span> \
              <span class="n">small_gam</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">L_washer</span><span class="o">/</span><span class="mi">100</span> <span class="c1"># (m)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">small_gam</span><span class="o">*</span><span class="n">L</span><span class="p">)</span>
            <span class="n">sw11_complex_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">big_gam</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">big_gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">sw21_complex_1</span> <span class="o">=</span> <span class="n">t</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">big_gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">big_gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="c1"># Symetrical washers</span>
            <span class="n">sw22_complex_1</span> <span class="o">=</span> <span class="n">sw11_complex_1</span>
            <span class="n">sw12_complex_1</span> <span class="o">=</span> <span class="n">sw21_complex_1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">L_1</span> <span class="o">=</span> <span class="n">L_washer1</span><span class="o">/</span><span class="mi">100</span> <span class="c1"># (m)</span>
            <span class="n">t_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">small_gam</span><span class="o">*</span><span class="n">L_1</span><span class="p">)</span>
            <span class="n">sw11_complex_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">big_gam</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t_1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">big_gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t_1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">sw21_complex_1</span> <span class="o">=</span> <span class="n">t_1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">big_gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">big_gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t_1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">sw22_complex_1</span> <span class="o">=</span> <span class="n">sw11_complex_1</span>
            <span class="n">sw12_complex_1</span> <span class="o">=</span> <span class="n">sw21_complex_1</span>
            <span class="n">L_2</span> <span class="o">=</span> <span class="n">L_washer2</span><span class="o">/</span><span class="mi">100</span> <span class="c1"># (m)</span>
            <span class="n">t_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">small_gam</span><span class="o">*</span><span class="n">L_2</span><span class="p">)</span>
            <span class="n">sw11_complex_2</span> <span class="o">=</span> <span class="p">(</span><span class="n">big_gam</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">t_2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">big_gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t_2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">sw21_complex_2</span> <span class="o">=</span> <span class="n">t_2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">big_gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">big_gam</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t_2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">sw22_complex_2</span> <span class="o">=</span> <span class="n">sw11_complex_2</span>
            <span class="n">sw12_complex_2</span> <span class="o">=</span> <span class="n">sw21_complex_2</span>

        <span class="c1"># Split measured sparams into mag and phase since uncertainties package </span>
        <span class="c1">#   does not support complex numbers</span>
        <span class="n">sm11_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sm22_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s22</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sm21_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sm12_mag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s12</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sm11_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sm22_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s22</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sm21_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s21</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sm12_phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s12</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Cast to complex and unwarp phase</span>
        <span class="n">sm11_complex</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm11_mag</span><span class="p">)</span><span class="o">*</span>\
                           <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm11_phase</span><span class="p">)))));</span> \
        <span class="n">sm11_complex</span> <span class="o">+=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm11_mag</span><span class="p">)</span><span class="o">*</span>\
                            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm11_phase</span><span class="p">))))</span>
        <span class="n">sm22_complex</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm22_mag</span><span class="p">)</span><span class="o">*</span>\
                           <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm22_phase</span><span class="p">)))));</span> \
        <span class="n">sm22_complex</span> <span class="o">+=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm22_mag</span><span class="p">)</span><span class="o">*</span>\
                            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm22_phase</span><span class="p">))))</span>
        <span class="n">sm21_complex</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm21_mag</span><span class="p">)</span><span class="o">*</span>\
                           <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm21_phase</span><span class="p">)))));</span> \
        <span class="n">sm21_complex</span> <span class="o">+=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm21_mag</span><span class="p">)</span><span class="o">*</span>\
                            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm21_phase</span><span class="p">))))</span>
        <span class="n">sm12_complex</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm12_mag</span><span class="p">)</span><span class="o">*</span>\
                           <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm12_phase</span><span class="p">)))));</span> \
        <span class="n">sm12_complex</span> <span class="o">+=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm12_mag</span><span class="p">)</span><span class="o">*</span>\
                            <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">sm12_phase</span><span class="p">))))</span>
                            
        <span class="c1">## De-embed</span>
        <span class="c1"># Convert to T-parameters</span>
        <span class="c1"># Washers</span>
        <span class="n">tw11_left</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">sw11_complex_1</span><span class="o">*</span><span class="n">sw22_complex_1</span><span class="o">-</span><span class="n">sw12_complex_1</span><span class="o">*</span>\
                          <span class="n">sw21_complex_1</span><span class="p">)</span><span class="o">/</span><span class="n">sw21_complex_1</span>
        <span class="n">tw12_left</span> <span class="o">=</span> <span class="n">sw11_complex_1</span><span class="o">/</span><span class="n">sw21_complex_1</span>
        <span class="n">tw21_left</span> <span class="o">=</span> <span class="o">-</span><span class="n">sw22_complex_1</span><span class="o">/</span><span class="n">sw21_complex_1</span>
        <span class="n">tw22_left</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">sw21_complex_1</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">tw11_right</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">sw11_complex_2</span><span class="o">*</span><span class="n">sw22_complex_2</span><span class="o">-</span><span class="n">sw12_complex_2</span><span class="o">*</span>\
                          <span class="n">sw21_complex_2</span><span class="p">)</span><span class="o">/</span><span class="n">sw21_complex_2</span>
            <span class="n">tw12_right</span> <span class="o">=</span> <span class="n">sw11_complex_2</span><span class="o">/</span><span class="n">sw21_complex_2</span>
            <span class="n">tw21_right</span> <span class="o">=</span> <span class="o">-</span><span class="n">sw22_complex_2</span><span class="o">/</span><span class="n">sw21_complex_2</span>
            <span class="n">tw22_right</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">sw21_complex_2</span>
        <span class="c1"># Measured</span>
        <span class="n">tm11</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">sm11_complex</span><span class="o">*</span><span class="n">sm22_complex</span><span class="o">-</span><span class="n">sm12_complex</span><span class="o">*</span>\
                 <span class="n">sm21_complex</span><span class="p">)</span><span class="o">/</span><span class="n">sm21_complex</span>
        <span class="n">tm12</span> <span class="o">=</span> <span class="n">sm11_complex</span><span class="o">/</span><span class="n">sm21_complex</span>
        <span class="n">tm21</span> <span class="o">=</span> <span class="o">-</span><span class="n">sm22_complex</span><span class="o">/</span><span class="n">sm21_complex</span>
        <span class="n">tm22</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">sm21_complex</span>
        <span class="c1"># Make matrices</span>
        <span class="n">left_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">tw11_left</span><span class="p">,</span><span class="n">tw12_left</span><span class="p">,</span><span class="n">tw21_left</span><span class="p">,</span>\
                                 <span class="n">tw22_left</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sw11_complex_1</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">right_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">tw11_right</span><span class="p">,</span><span class="n">tw12_right</span><span class="p">,</span><span class="n">tw21_right</span><span class="p">,</span>\
                                 <span class="n">tw22_right</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sw11_complex_1</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Washers are symetrical</span>
            <span class="n">right_matrix</span> <span class="o">=</span> <span class="n">left_matrix</span>  
        <span class="n">meas_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">tm11</span><span class="p">,</span><span class="n">tm12</span><span class="p">,</span><span class="n">tm21</span><span class="p">,</span>\
                                 <span class="n">tm22</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sm11_complex</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Perform de-embeding</span>
        <span class="n">corr_Tmatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">left_matrix</span><span class="p">),</span><span class="n">meas_matrix</span><span class="p">)</span>
        <span class="n">corr_Tmatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">corr_Tmatrix</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">right_matrix</span><span class="p">))</span>
        <span class="c1"># Re-convert to S-parameters</span>
        <span class="n">corr_s11_complex</span> <span class="o">=</span> <span class="n">corr_Tmatrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">corr_Tmatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">corr_s12_complex</span> <span class="o">=</span> <span class="p">(</span><span class="n">corr_Tmatrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">corr_Tmatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span>\
                    <span class="n">corr_Tmatrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">corr_Tmatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">corr_Tmatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">corr_s21_complex</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">corr_Tmatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">corr_s22_complex</span> <span class="o">=</span> <span class="o">-</span><span class="n">corr_Tmatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">corr_Tmatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Re-cast to mag and phase</span>
        <span class="c1"># Use arctan2 to compute phase since it keeps track of signs (wraps)</span>
        <span class="n">corr_s11_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">corr_s11_complex</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">corr_s11_complex</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="n">corr_s12_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">corr_s12_complex</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">corr_s12_complex</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="n">corr_s21_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">corr_s21_complex</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">corr_s21_complex</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="n">corr_s22_phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">corr_s22_complex</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">corr_s22_complex</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
        <span class="c1">## Build final corrected arrays</span>
        <span class="c1"># Get corrected mag and phase</span>
        <span class="n">corr_s11_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">corr_s11_complex</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
                                     <span class="n">corr_s11_complex</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">corr_s11_phase</span> <span class="o">=</span> <span class="n">corr_s11_phase</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">corr_s12_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">corr_s12_complex</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
                                     <span class="n">corr_s12_complex</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">corr_s12_phase</span> <span class="o">=</span> <span class="n">corr_s12_phase</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">corr_s21_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">corr_s21_complex</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
                                     <span class="n">corr_s21_complex</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">corr_s21_phase</span> <span class="o">=</span> <span class="n">corr_s21_phase</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">corr_s22_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">corr_s22_complex</span><span class="o">.</span><span class="n">real</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
                                     <span class="n">corr_s22_complex</span><span class="o">.</span><span class="n">imag</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">corr_s22_phase</span> <span class="o">=</span> <span class="n">corr_s22_phase</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="c1"># Get original s-param uncertainties</span>
        <span class="c1"># NOTE: This is an underestimate of the real uncertainties since they \</span>
        <span class="c1">#   are not properly propagated in de-embedding but they are \</span>
        <span class="c1">#   probably still much smaller at high freqencies than the stardard \</span>
        <span class="c1">#   deviation of the measurement. To be fixed when the uncertainties \</span>
        <span class="c1">#   package can handle complex numbers.</span>
        <span class="n">err_s11_mag</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">err_s11_phase</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">err_s12_mag</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s12</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">err_s12_phase</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s12</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">err_s21_mag</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s21</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">err_s21_phase</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s21</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">err_s22_mag</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s22</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">err_s22_phase</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s22</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Make final arrays with uncertainties</span>
        <span class="n">corr_s11</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">([</span><span class="n">corr_s11_mag</span><span class="p">,</span><span class="n">corr_s11_phase</span><span class="p">],</span>\
                              <span class="p">[</span><span class="n">err_s11_mag</span><span class="p">,</span><span class="n">err_s11_phase</span><span class="p">])</span>
        <span class="n">corr_s12</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">([</span><span class="n">corr_s12_mag</span><span class="p">,</span><span class="n">corr_s12_phase</span><span class="p">],</span>\
                              <span class="p">[</span><span class="n">err_s12_mag</span><span class="p">,</span><span class="n">err_s12_phase</span><span class="p">])</span>
        <span class="n">corr_s21</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">([</span><span class="n">corr_s21_mag</span><span class="p">,</span><span class="n">corr_s21_phase</span><span class="p">],</span>\
                              <span class="p">[</span><span class="n">err_s21_mag</span><span class="p">,</span><span class="n">err_s21_phase</span><span class="p">])</span>
        <span class="n">corr_s22</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">([</span><span class="n">corr_s22_mag</span><span class="p">,</span><span class="n">corr_s22_phase</span><span class="p">],</span>\
                              <span class="p">[</span><span class="n">err_s22_mag</span><span class="p">,</span><span class="n">err_s22_phase</span><span class="p">])</span>
            
        <span class="k">return</span> <span class="n">corr_s11</span><span class="p">,</span> <span class="n">corr_s21</span><span class="p">,</span> <span class="n">corr_s12</span><span class="p">,</span> <span class="n">corr_s22</span></div>
    
<div class="viewcode-block" id="AirlineData._boundary_correct"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData._boundary_correct">[docs]</a>    <span class="k">def</span> <span class="nf">_boundary_correct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Correct calculated sprams for boundary effects in the airline after </span>
<span class="sd">        Hickson et al., 2017. Requires the effective solid permittivity </span>
<span class="sd">        of the material, the average particle size in the airline, and </span>
<span class="sd">        the average particle (solid) density to be supplied to the class</span>
<span class="sd">        instance. Uses the Looyenga mixing model to calculate the </span>
<span class="sd">        permittivity in the boundary region.</span>
<span class="sd">            </span>
<span class="sd">        As of now, produces dubious results for the imaginary part.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="mf">1.835</span>    <span class="c1"># Porosity proportinality constant</span>
        <span class="c1"># Use washer corrected data if it exists</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">:</span>
            <span class="n">measured_dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span><span class="p">)</span>
            <span class="n">measured_lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lcorr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">measured_dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span><span class="p">)</span>
            <span class="n">measured_lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span>
        
        <span class="c1"># Determine boundary region porosity</span>
        <span class="n">total_volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D4&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">L</span> <span class="o">-</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">L</span>
        <span class="n">sample_volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D3&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">L</span> <span class="o">-</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D2&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">L</span>
        <span class="n">boundary_volume</span> <span class="o">=</span> <span class="n">total_volume</span> <span class="o">-</span> <span class="n">sample_volume</span>
        <span class="n">total_porosity</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bulk_density</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">particle_density</span><span class="p">)</span>
        <span class="n">boundary_porosity</span> <span class="o">=</span> <span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="n">total_porosity</span> <span class="o">*</span> <span class="n">total_volume</span><span class="p">)</span> <span class="o">/</span> \
            <span class="p">(</span><span class="n">sample_volume</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="n">boundary_volume</span><span class="p">)</span>
            
        <span class="c1"># Calculate boundary region permittivity using Looyenga mixing model</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solid_losstan</span><span class="p">:</span>  <span class="c1">#Cast to complex if appropriate</span>
            <span class="n">solid_lossfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solid_dielec</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">solid_losstan</span>
            <span class="n">solid_permittivity</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solid_dielec</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">solid_lossfac</span><span class="p">))</span>
            <span class="n">solid_permittivity</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solid_dielec</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">solid_lossfac</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">solid_permittivity</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="mi">0</span>
            <span class="n">solid_permittivity</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solid_dielec</span>
        <span class="c1"># Looyenga eqn. for air (ep_air = 1)</span>
        <span class="n">epsilon_thrid</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">boundary_porosity</span><span class="p">)</span><span class="o">*</span><span class="n">solid_permittivity</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> \
            <span class="o">+</span> <span class="n">boundary_porosity</span>
        <span class="n">boundary_permittivity</span> <span class="o">=</span> <span class="n">epsilon_thrid</span><span class="o">**</span><span class="mi">3</span>
        
        <span class="c1"># Cast measured average permittivity to complex</span>
        <span class="n">measured_permittivity</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">measured_dielec</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">measured_lossfac</span><span class="p">))</span>
        <span class="n">measured_permittivity</span> <span class="o">+=</span> <span class="n">measured_dielec</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">measured_lossfac</span><span class="p">)</span>
        
        <span class="c1"># Calculate model corrected sample permittivity</span>
        <span class="n">sample_permittivity</span> <span class="o">=</span> <span class="p">(</span><span class="n">boundary_permittivity</span> <span class="o">*</span> <span class="n">measured_permittivity</span> \
            <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D3&#39;</span><span class="p">]</span><span class="o">/</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D2&#39;</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">boundary_permittivity</span> <span class="o">*</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D4&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">])</span> \
            <span class="o">-</span> <span class="n">measured_permittivity</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D2&#39;</span><span class="p">]</span><span class="o">/</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D4&#39;</span><span class="p">]</span>\
            <span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D3&#39;</span><span class="p">])))</span>
            
        <span class="c1"># Unpack complex</span>
        <span class="n">sample_dielec</span> <span class="o">=</span> <span class="n">sample_permittivity</span><span class="o">.</span><span class="n">real</span>
        <span class="n">samples_losstan</span> <span class="o">=</span> <span class="n">sample_permittivity</span><span class="o">.</span><span class="n">imag</span> <span class="o">/</span> <span class="n">sample_dielec</span>
        <span class="k">return</span> <span class="n">sample_dielec</span><span class="p">,</span> <span class="n">samples_losstan</span></div>
    
<div class="viewcode-block" id="AirlineData._air_gap_correction"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData._air_gap_correction">[docs]</a>    <span class="k">def</span> <span class="nf">_air_gap_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">D2</span><span class="p">,</span> <span class="n">D3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates air gap corrected complex permittivity for solid samples.</span>
<span class="sd">        </span>
<span class="sd">        Follows Baker-Jarvis et al., 1993 and Rhode &amp; Schwarz </span>
<span class="sd">        Application Note RAC0607-0019_1_4E</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Ds2 : float </span>
<span class="sd">            The inner diameter (cm) of the solid toroid sample to be specified </span>
<span class="sd">            by user</span>
<span class="sd">        </span>
<span class="sd">        Ds3 : float T</span>
<span class="sd">            The outer diameter (cm) of the solid toroid sample to be specified </span>
<span class="sd">            by user</span>
<span class="sd">        </span>
<span class="sd">        Return</span>
<span class="sd">        ---------</span>
<span class="sd">        corr_dielec : array </span>
<span class="sd">            Corrected real part of measured permittivity</span>
<span class="sd">        </span>
<span class="sd">        corr_lossfac : array </span>
<span class="sd">            Corrected imaginary part of measured permittivity</span>
<span class="sd">        </span>
<span class="sd">        corr_losstan : array </span>
<span class="sd">            Corrected loss tangent </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">:</span>
            <span class="n">measured_dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span><span class="p">)</span>
            <span class="n">measured_lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">measured_dielec</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span><span class="p">)</span>
            <span class="n">measured_lossfac</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="p">)</span>
        
        <span class="c1"># Calculate L1, L2, and L3 terms</span>
        <span class="n">L1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">D2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D4&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">D3</span><span class="p">)</span>
        <span class="n">L2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">D3</span><span class="o">/</span><span class="n">D2</span><span class="p">)</span>
        <span class="n">L3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D4&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">airline_dimensions</span><span class="p">[</span><span class="s1">&#39;D1&#39;</span><span class="p">])</span>
        
        <span class="c1"># Calculate corr_dielec, corr_lossfac </span>
        <span class="n">corr_dielec</span>  <span class="o">=</span> <span class="n">measured_dielec</span><span class="o">*</span><span class="p">(</span><span class="n">L2</span><span class="o">/</span><span class="p">(</span><span class="n">L3</span> <span class="o">-</span> <span class="n">measured_dielec</span><span class="o">*</span><span class="n">L1</span><span class="p">))</span>
        <span class="n">corr_lossfac</span> <span class="o">=</span> <span class="p">(</span><span class="n">corr_dielec</span><span class="o">*</span><span class="p">(</span><span class="n">measured_lossfac</span><span class="o">/</span><span class="n">measured_dielec</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">L3</span><span class="o">/</span><span class="p">(</span><span class="n">L3</span> <span class="o">-</span> <span class="n">L1</span> \
                       <span class="o">*</span><span class="n">measured_dielec</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">measured_lossfac</span><span class="o">/</span><span class="n">measured_dielec</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">corr_losstan</span> <span class="o">=</span> <span class="n">corr_lossfac</span><span class="o">/</span><span class="n">corr_dielec</span>
        
        <span class="k">return</span> <span class="n">corr_dielec</span><span class="p">,</span> <span class="n">corr_lossfac</span><span class="p">,</span> <span class="n">corr_losstan</span></div>
        
        
<div class="viewcode-block" id="AirlineData.draw_plots"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData.draw_plots">[docs]</a>    <span class="k">def</span> <span class="nf">draw_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">default_settings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">publish</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">log_y_axis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                   <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">corr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">normalized</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots permittivity data using make_plot from permittivity_plot.</span>
<span class="sd">        </span>
<span class="sd">        If freq_cutoff exists, all frequency points lower than freq_cutoff </span>
<span class="sd">        will not be plotted.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        default_settings : bool </span>
<span class="sd">            Default: True. If True, plots average real part of the permittivity, </span>
<span class="sd">            imaginary part of the permittivity and loss tangent. If corrected</span>
<span class="sd">            or normalized data exist, it will be used in the plot. If False </span>
<span class="sd">            prompts user to determine whether to plot, Average, Forward, </span>
<span class="sd">            Reverse, or All results.</span>
<span class="sd">        </span>
<span class="sd">        publish : bool </span>
<span class="sd">            Default: False. If True, save figures.</span>
<span class="sd">            </span>
<span class="sd">        log_y_axis : bool</span>
<span class="sd">            Default: False. If True, plot log y-axis. yticks must be provided </span>
<span class="sd">            if True.</span>
<span class="sd">            </span>
<span class="sd">        xticks : list, optional</span>
<span class="sd">            Use to manually set y-axis tick make locations. Must be a list </span>
<span class="sd">            containing tick mark locations.</span>
<span class="sd">            </span>
<span class="sd">        yticks : list of lists, optional</span>
<span class="sd">            Use to manually set y-axis tick make locations. Must be a list of</span>
<span class="sd">            lists containing tick mark locations for each individual plot in </span>
<span class="sd">            the following order: real part, imaginary part, loss tangent. If </span>
<span class="sd">            nrw=True, must additionaly provide: real part of mu, </span>
<span class="sd">            imaginary part of mu. Required if log_y_axis=True.</span>
<span class="sd">            </span>
<span class="sd">        corr : bool, optional</span>
<span class="sd">            Can be used when default_settings is False. Can be used with any of </span>
<span class="sd">            the plot types. If True, use corrected sparam data, otheriwse use </span>
<span class="sd">            uncorrected data.</span>
<span class="sd">            </span>
<span class="sd">        normalized : bool, optional</span>
<span class="sd">            Can be used when default_settings is False. Can only be used with </span>
<span class="sd">            Average plots. If True, use normalized permittivity data. </span>
<span class="sd">            Supersedes corr if True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If default_settings</span>
        <span class="c1">#   Use first of normalized, corrected, or regular data</span>
        <span class="k">if</span> <span class="n">default_settings</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_density</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting normalized data&#39;</span><span class="p">)</span>
            <span class="n">plot_dielec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_dielec</span>
            <span class="n">plot_lossfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_lossfac</span>
            <span class="n">plot_losstan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_losstan</span>
        <span class="k">elif</span> <span class="n">default_settings</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting corrected data&#39;</span><span class="p">)</span>
            <span class="n">plot_dielec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span>
            <span class="n">plot_lossfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span>
            <span class="n">plot_losstan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_losstan</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                <span class="n">plot_mureal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_mu_real</span>
                <span class="n">plot_muimag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_mu_imag</span>
        <span class="k">elif</span> <span class="n">default_settings</span><span class="p">:</span>
            <span class="n">plot_dielec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span>
            <span class="n">plot_lossfac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span>
            <span class="n">plot_losstan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_losstan</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                <span class="n">plot_mureal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_mu_real</span>
                <span class="n">plot_muimag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_mu_imag</span>
        
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
        <span class="c1"># Figure out what to plot</span>
        <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">default_settings</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">plot_dielec</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">plot_lossfac</span>
            <span class="n">y3</span> <span class="o">=</span> <span class="n">plot_losstan</span>
            <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;legend_label&quot;</span><span class="p">:[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                <span class="n">y4</span> <span class="o">=</span> <span class="n">plot_mureal</span>
                <span class="n">y5</span> <span class="o">=</span> <span class="n">plot_muimag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Prompt user</span>
            <span class="n">s_plot</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please designate &quot;a&quot; for Average, &#39;</span> <span class="o">+</span> \
                           <span class="s1">&#39;&quot;f&quot; for Forward (S11,S21), &quot;r&quot; for &#39;</span> <span class="o">+</span> \
                           <span class="s1">&#39;Reverse (S22,S12), or &quot;all&quot; for All three: &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s_plot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Wrong input&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">s_plot</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span> <span class="ow">and</span> <span class="n">normalized</span><span class="p">:</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_dielec</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_lossfac</span>
                <span class="n">y3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_losstan</span>
            <span class="k">elif</span> <span class="n">s_plot</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span> <span class="ow">and</span> <span class="n">corr</span><span class="p">:</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span>
                <span class="n">y3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_losstan</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                    <span class="n">y4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_mu_real</span>
                    <span class="n">y5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_mu_imag</span>
            <span class="k">elif</span> <span class="n">s_plot</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span> <span class="p">:</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span>
                <span class="n">y3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_losstan</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                    <span class="n">y4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_mu_real</span>
                    <span class="n">y5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">avg_mu_imag</span>
            <span class="k">elif</span> <span class="n">normalized</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;normalized=True can only be used with Average &quot;a&quot; plots&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">s_plot</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_dielec</span>
                    <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_lossfac</span>
                    <span class="n">y3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_losstan</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                        <span class="n">y4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_mu_real</span>
                        <span class="n">y5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_mu_imag</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_dielec</span>
                    <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_lossfac</span>
                    <span class="n">y3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_losstan</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                        <span class="n">y4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_mu_real</span>
                        <span class="n">y5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_mu_imag</span>
            <span class="k">elif</span> <span class="n">s_plot</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_dielec</span>
                    <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_lossfac</span>
                    <span class="n">y3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_losstan</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                        <span class="n">y4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_mu_real</span>
                        <span class="n">y5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_mu_imag</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_dielec</span>
                    <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_lossfac</span>
                    <span class="n">y3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_losstan</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                        <span class="n">y4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_mu_real</span>
                        <span class="n">y5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_mu_imag</span>
            <span class="k">elif</span> <span class="n">s_plot</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">and</span> <span class="n">corr</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">]</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_dielec</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_dielec</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_dielec</span><span class="p">]</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_lossfac</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_lossfac</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_lossfac</span><span class="p">]</span>
                <span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_losstan</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_losstan</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_losstan</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                    <span class="n">y4</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_mu_real</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_mu_real</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_mu_real</span><span class="p">]</span>
                    <span class="n">y5</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_forward_mu_imag</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_reverse_mu_imag</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_avg_mu_imag</span><span class="p">]</span>
                <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;legend_label&quot;</span><span class="p">:[</span><span class="s1">&#39;Forward [S11,S21]&#39;</span><span class="p">,</span><span class="s1">&#39;Reverse [S22,S12]&#39;</span><span class="p">,</span><span class="s1">&#39;Average&#39;</span><span class="p">]}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">]</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_dielec</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_dielec</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_dielec</span><span class="p">]</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_lossfac</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_lossfac</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_lossfac</span><span class="p">]</span>
                <span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_losstan</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_losstan</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_losstan</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                    <span class="n">y4</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_mu_real</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_mu_real</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_mu_real</span><span class="p">]</span>
                    <span class="n">y5</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">forward_mu_imag</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">reverse_mu_imag</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">avg_mu_imag</span><span class="p">]</span>
                <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;legend_label&quot;</span><span class="p">:[</span><span class="s1">&#39;Forward [S11,S21]&#39;</span><span class="p">,</span><span class="s1">&#39;Reverse [S22,S12]&#39;</span><span class="p">,</span><span class="s1">&#39;Average&#39;</span><span class="p">]}</span>
        <span class="c1"># Pass publish arguments        </span>
        <span class="k">if</span> <span class="n">publish</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="p">[</span><span class="s1">&#39;publish&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">plot_kwargs</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># Pass freq_cutoff</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="p">[</span><span class="s1">&#39;freq_cutoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span>
        <span class="k">if</span> <span class="n">log_y_axis</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="p">[</span><span class="s1">&#39;y_axis_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>
        <span class="k">if</span> <span class="n">xticks</span><span class="p">:</span>
            <span class="n">plot_kwargs</span><span class="p">[</span><span class="s1">&#39;xticks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xticks</span>
        <span class="c1"># Make plots</span>
        <span class="k">if</span> <span class="n">yticks</span><span class="p">:</span>
            <span class="n">pplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="n">pplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;lf&#39;</span><span class="p">,</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="n">pplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="s1">&#39;lt&#39;</span><span class="p">,</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                <span class="n">pplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y4</span><span class="p">,</span><span class="s1">&#39;ur&#39;</span><span class="p">,</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
                <span class="n">pplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y5</span><span class="p">,</span><span class="s1">&#39;ui&#39;</span><span class="p">,</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="n">pplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="s1">&#39;lf&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="n">pplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="s1">&#39;lt&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nrw</span><span class="p">:</span>
                <span class="n">pplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y4</span><span class="p">,</span><span class="s1">&#39;ur&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>
                <span class="n">pplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y5</span><span class="p">,</span><span class="s1">&#39;ui&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="AirlineData.s_param_plot"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData.s_param_plot">[docs]</a>    <span class="k">def</span> <span class="nf">s_param_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">corr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot raw S-Parameter data using make_sparam_plot from</span>
<span class="sd">        permittivity_plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>
            <span class="n">pplot</span><span class="o">.</span><span class="n">make_sparam_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_s11</span><span class="p">],</span>\
                                   <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">s22</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_s22</span><span class="p">],[</span><span class="bp">self</span><span class="o">.</span><span class="n">s21</span><span class="p">,</span>\
                                   <span class="bp">self</span><span class="o">.</span><span class="n">corr_s21</span><span class="p">],[</span><span class="bp">self</span><span class="o">.</span><span class="n">s12</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">corr_s12</span><span class="p">],</span>\
                                   <span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Uncorrected&#39;</span><span class="p">,</span><span class="s1">&#39;Corrected&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shorted</span><span class="p">:</span>
                <span class="n">pplot</span><span class="o">.</span><span class="n">make_sparam_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">s22</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">s21</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">s12</span><span class="p">,</span><span class="n">shorted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">s11_short</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s11_short</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pplot</span><span class="o">.</span><span class="n">make_sparam_plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">s11</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">s22</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">s21</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">s12</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="AirlineData.difference_plot"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.AirlineData.difference_plot">[docs]</a>    <span class="k">def</span> <span class="nf">difference_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the absolute difference between both ε′ and ε′′ calculated from </span>
<span class="sd">        forward (S11,S21) and reverse (S22,S12) S-Paramaters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">]</span>
            <span class="n">real_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_part_diff_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">]</span>
            <span class="n">imag_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag_part_diff_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
            <span class="n">real_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_part_diff_array</span>
            <span class="n">imag_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imag_part_diff_array</span>
        
        <span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">real_diff</span><span class="p">,</span><span class="s1">&#39;ko-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;|$\epsilon^\prime[S_</span><span class="si">{11}</span><span class="s1">,S_</span><span class="si">{21}</span><span class="s1">]$ - $\epsilon^\prime[S_</span><span class="si">{22}</span><span class="s1">,S_</span><span class="si">{12}</span><span class="s1">]$|&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Difference in $\epsilon^\prime$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">10e-7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">imag_diff</span><span class="p">,</span><span class="s1">&#39;ko-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;|$\epsilon^{\prime\prime}[S_</span><span class="si">{11}</span><span class="s1">,S_</span><span class="si">{21}</span><span class="s1">]$ - $\epsilon^{\prime\prime}[S_</span><span class="si">{22}</span><span class="s1">,S_</span><span class="si">{12}</span><span class="s1">]$|&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Difference in $\epsilon^{\prime\prime}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">10e-7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoff</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="k">import</span> <span class="n">FixedLocator</span><span class="p">,</span> <span class="n">LogLocator</span><span class="p">,</span> <span class="n">EngFormatter</span><span class="p">,</span> <span class="n">NullFormatter</span>
            <span class="n">x_logmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span> <span class="c1"># log of min and max x values</span>
            <span class="n">x_logmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span>
            <span class="n">x_logticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">x_logmin</span><span class="p">,</span> <span class="n">x_logmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># 4 equaly spaced points in log space</span>
            <span class="n">x_ticklocs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_logticks</span><span class="p">)):</span> <span class="c1"># round scientific values and make a list</span>
                <span class="n">x_ticklocs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">format_float_scientific</span><span class="p">(</span><span class="n">x_logticks</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>\
                                <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x_ticklocs</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span> <span class="c1"># check that this produced 4 unique values</span>
                <span class="n">x_ticklocs</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># if not do it again with precision = 1</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_logticks</span><span class="p">)):</span> 
                    <span class="n">x_ticklocs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">format_float_scientific</span><span class="p">(</span><span class="n">x_logticks</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>\
                                <span class="p">,</span><span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
            <span class="n">majorLocator</span> <span class="o">=</span> <span class="n">FixedLocator</span><span class="p">(</span><span class="n">x_ticklocs</span><span class="p">)</span>
            <span class="n">majorFormatter</span> <span class="o">=</span> <span class="n">EngFormatter</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">)</span> <span class="c1"># Format major ticks with units</span>
            <span class="n">minorLocator</span> <span class="o">=</span> <span class="n">LogLocator</span><span class="p">(</span><span class="n">subs</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span> <span class="c1"># Use all interger multiples of the log base for minor ticks </span>
            <span class="n">minorFormatter</span> <span class="o">=</span>  <span class="n">NullFormatter</span><span class="p">()</span> <span class="c1"># No minor tick labels </span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="c1"># Apply x ticks</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">majorLocator</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">majorFormatter</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">minorLocator</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">minorFormatter</span><span class="p">)</span>
                <span class="c1"># Format the actual tick marks</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                <span class="c1"># Use smaller line width for minor tick grid lines</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>
            
<span class="c1">#%% Functions</span>
            
<div class="viewcode-block" id="multiple_meas"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.multiple_meas">[docs]</a><span class="k">def</span> <span class="nf">multiple_meas</span><span class="p">(</span><span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">airline_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate an instance of AirlineData for every file in a directory. Store </span>
<span class="sd">    the intances in a list, and plot them all using perm_compare.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_path : str, optional </span>
<span class="sd">        Full path of any file in the source directory. Will produce file dialog </span>
<span class="sd">        box if not provided.</span>
<span class="sd">    </span>
<span class="sd">    airlne : str, optional</span>
<span class="sd">        Name of airline used. Every measurement must have been made </span>
<span class="sd">        in the same airline. Will prompt if not provided.</span>
<span class="sd">        </span>
<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    class_list : lst </span>
<span class="sd">        List of generated class instances of AirlineData.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Use _get_file to get the filepath and airline name if not provided</span>
    <span class="k">if</span> <span class="n">file_path</span><span class="p">:</span>   <span class="c1"># If file path provided as argument</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">file_path</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">file_path</span><span class="p">:</span>   <span class="c1"># If file path not provided</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Select any data file in the source folder. All .txt &quot;</span><span class="o">+</span>\
              <span class="s2">&quot;files in the source folder must be METAS data tables.&quot;</span><span class="p">)</span>
        <span class="c1"># Get the file path and the airline name</span>
        <span class="n">airline_name</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">L_in</span> <span class="o">=</span> <span class="n">_get_file</span><span class="p">(</span><span class="n">airline_name</span><span class="p">,</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">airline_name</span><span class="p">:</span>   <span class="c1"># If file path is given but airline is not</span>
        <span class="n">airline_name</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">L_in</span> <span class="o">=</span> <span class="n">_get_file</span><span class="p">(</span><span class="n">airline_name</span><span class="p">,</span><span class="n">file_path</span><span class="p">)</span>
        
    <span class="c1"># Get directory path    </span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="c1"># Use a list to maintain order for plotting</span>
    <span class="n">class_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Iterate through all .txt files in the directory and run AirlineData</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.txt&quot;</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># Use file name as plot label</span>
            <span class="c1"># Append each new instance to class list</span>
            <span class="n">class_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AirlineData</span><span class="p">(</span><span class="o">*</span><span class="n">get_METAS_data</span><span class="p">(</span><span class="n">airline_name</span><span class="p">,</span>\
                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">file</span><span class="p">)),</span><span class="n">name</span><span class="o">=</span><span class="n">filename</span><span class="p">))</span>
    
    <span class="c1"># Plot all files        </span>
    <span class="n">perm_compare</span><span class="p">(</span><span class="n">class_list</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">class_list</span> </div>

<div class="viewcode-block" id="run_default"><a class="viewcode-back" href="../../airlinedata.html#permittivitycalc.run_default">[docs]</a><span class="k">def</span> <span class="nf">run_default</span><span class="p">(</span><span class="n">airline_name</span><span class="o">=</span><span class="s1">&#39;VAL&#39;</span><span class="p">,</span><span class="n">file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run AirlineData on get_METAS_data with all the prompts and return the </span>
<span class="sd">    instance. Optional AirlineData kwargs can be provided (Example: shorted=True).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">AirlineData</span><span class="p">(</span><span class="o">*</span><span class="n">get_METAS_data</span><span class="p">(</span><span class="n">airline_name</span><span class="p">,</span><span class="n">file_path</span><span class="p">),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">run_example</span><span class="p">():</span>
    <span class="n">rexolite_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATAPATH</span><span class="p">,</span> <span class="s1">&#39;rexolite_PAL.txt&#39;</span><span class="p">)</span>
    <span class="n">serpentine_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATAPATH</span><span class="p">,</span> <span class="s1">&#39;serpentine_dry.txt&#39;</span><span class="p">)</span>
    <span class="n">rexolite_example</span> <span class="o">=</span> <span class="n">AirlineData</span><span class="p">(</span><span class="o">*</span><span class="n">get_METAS_data</span><span class="p">(</span><span class="n">airline</span><span class="o">=</span><span class="s1">&#39;PAL&#39;</span><span class="p">,</span>\
        <span class="n">file_path</span><span class="o">=</span><span class="n">rexolite_path</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Rexolite&#39;</span><span class="p">)</span>
    <span class="n">serpentine_example</span> <span class="o">=</span> <span class="n">AirlineData</span><span class="p">(</span><span class="o">*</span><span class="n">get_METAS_data</span><span class="p">(</span><span class="n">airline</span><span class="o">=</span><span class="s1">&#39;VAL&#39;</span><span class="p">,</span>\
        <span class="n">file_path</span><span class="o">=</span><span class="n">serpentine_path</span><span class="p">),</span><span class="n">bulk_density</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span>\
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Serpentine&#39;</span><span class="p">,</span><span class="n">normalize_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">norm_eqn</span><span class="o">=</span><span class="s1">&#39;LI&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rexolite_example</span><span class="p">,</span> <span class="n">serpentine_example</span>

<span class="c1">#%% MAIN</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1">## Run Examples</span>
    <span class="k">global</span> <span class="n">rexolite_example</span>
    <span class="k">global</span> <span class="n">serpentine_example</span>
    <span class="n">rexolite_example</span><span class="p">,</span> <span class="n">serpentine_example</span> <span class="o">=</span> <span class="n">run_example</span><span class="p">()</span>
    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>  <span class="c1"># Comment to supress example</span>
<span class="c1">#    pass    # Uncomment to supress example</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Alexandre Boivin

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>